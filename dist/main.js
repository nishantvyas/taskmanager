(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function tt(t,e){const n=t.getTime()-e.getTime();return Math.ceil(n/(1e3*60*60*24))}function et(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60*60))}function ot(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60))}function nt(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/1e3)}let c={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};class at{constructor(){this.state=c}generateProjectId(){return"project_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async createProject(e){const n=this.generateProjectId(),o={id:n,goal:e.goal||"New Project",targetDate:e.targetDate||null,goalCreatedAt:e.goalCreatedAt||new Date,tasks:e.tasks||[],doneTasks:e.doneTasks||[],color:e.color||this.state.globalSettings.defaultProjectColor,isActive:!0,order:this.state.projectOrder.length,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.state.projects[n]=o,this.state.projectOrder.push(n),this.state.activeProjectId||(this.state.activeProjectId=n),await f(),o}getProject(e){return this.state.projects[e]||null}async updateProject(e,n){return this.state.projects[e]?(this.state.projects[e]={...this.state.projects[e],...n,updatedAt:new Date().toISOString()},await f(),this.state.projects[e]):null}async deleteProject(e){return this.state.projects[e]?(delete this.state.projects[e],this.state.projectOrder=this.state.projectOrder.filter(n=>n!==e),this.state.activeProjectId===e&&(this.state.activeProjectId=this.state.projectOrder.length>0?this.state.projectOrder[0]:null),await f(),!0):!1}getActiveProject(){return this.state.activeProjectId?this.state.projects[this.state.activeProjectId]:null}async setActiveProject(e){return this.state.projects[e]?(this.state.activeProjectId=e,await f(),!0):!1}getAllProjects(){return this.state.projectOrder.map(e=>this.state.projects[e]).filter(Boolean)}getActiveProjects(){return this.getAllProjects().filter(e=>e.isActive)}}const g=new at,a={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),deleteTaskBtn:document.getElementById("deleteTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip"),projectDropdownBtn:document.getElementById("projectDropdownBtn"),projectDropdownMenu:document.getElementById("projectDropdownMenu"),currentProjectName:document.getElementById("currentProjectName"),addProjectBtn:document.getElementById("addProjectBtn"),projectList:document.getElementById("projectList"),projectDropdown:document.querySelector(".project-dropdown"),settingsTabs:document.querySelectorAll(".settings-tab"),settingsTabContents:document.querySelectorAll(".settings-tab-content"),projectColorInput:document.getElementById("projectColorInput"),allProjectsList:document.getElementById("allProjectsList"),createProjectModal:document.getElementById("createProjectModal"),newProjectName:document.getElementById("newProjectName"),newProjectDate:document.getElementById("newProjectDate"),newProjectColor:document.getElementById("newProjectColor"),createProjectBtn:document.getElementById("createProjectBtn"),cancelCreateProjectBtn:document.getElementById("cancelCreateProjectBtn"),confirmationModal:document.getElementById("confirmationModal"),confirmationTitle:document.getElementById("confirmationTitle"),confirmationMessage:document.getElementById("confirmationMessage"),confirmBtn:document.getElementById("confirmBtn"),cancelConfirmBtn:document.getElementById("cancelConfirmBtn"),notificationModal:document.getElementById("notificationModal"),notificationTitle:document.getElementById("notificationTitle"),notificationMessage:document.getElementById("notificationMessage"),closeNotificationBtn:document.getElementById("closeNotificationBtn"),projectNameCounter:document.getElementById("projectNameCounter"),goalCounter:document.getElementById("goalCounter")};let v=null,D=null;async function st(){await it(),rt(),h(),It(),vt()}function rt(){let t=!1;c.doneTasks.forEach(e=>{e.completedAt&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),c.tasks.forEach(e=>{(e.createdAt||e.updatedAt)&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),t&&(console.log("Marked tasks as migrated to new timezone handling"),f())}function ct(){if(!c.projects)return;const t=new Date,e=new Date(t.getTime()-90*24*60*60*1e3);let n=0;Object.keys(c.projects).forEach(o=>{const s=c.projects[o];if(!Array.isArray(s.doneTasks)||s.doneTasks.length<=1e3)return;const i=[...s.doneTasks].sort((d,p)=>new Date(p.completedAt||p.updatedAt||p.createdAt)-new Date(d.completedAt||d.updatedAt||d.createdAt)).slice(0,1e3),u=new Set(i.map(d=>d.id)),m=s.doneTasks.filter(d=>u.has(d.id)?!1:new Date(d.completedAt||d.updatedAt||d.createdAt)>=e),l=[...i,...m];if(l.length<s.doneTasks.length){const d=s.doneTasks.length-l.length;n+=d,s.doneTasks=l}}),n>0&&(console.log(`Cleaned up ${n} old completed tasks across all projects`),f())}async function it(){try{const t=await chrome.storage.local.get(["projects_data","global_settings","active_project","project_order","migration_version"]);if(t.migration_version===2&&t.projects_data){console.log("Loading multi-project data"),console.log("Raw projects_data:",t.projects_data);try{const e=JSON.parse(t.projects_data);console.log("Parsed projects:",e),console.log("Number of projects:",Object.keys(e).length),c={projects:e,activeProjectId:t.active_project,projectOrder:JSON.parse(t.project_order||"[]"),globalSettings:JSON.parse(t.global_settings||"{}"),migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},console.log("Loaded state:",{projectCount:Object.keys(c.projects).length,activeProjectId:c.activeProjectId,projectOrder:c.projectOrder})}catch(e){throw console.error("Error parsing projects data:",e),console.log("Corrupted projects_data:",t.projects_data),e}c.globalSettings={theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10,...c.globalSettings},g.state=c,console.log("ProjectManager state updated after loading")}else console.log("Checking for single-project data to migrate"),await lt();ct(),g.state=c,console.log("Final ProjectManager state sync after loadState")}catch(t){console.error("Error loading state:",t),await _()}}async function lt(){console.log("Starting migration to multi-project structure");try{const t=await chrome.storage.local.get(["goalState","tasks","doneTasks"]);let e=!1,n={goal:"My First Project",targetDate:null,goalCreatedAt:new Date,tasks:[],doneTasks:[]};if(t.goalState){console.log("Found old single-project data, migrating...");const o=JSON.parse(t.goalState);n={goal:o.goal||"My First Project",targetDate:o.targetDate?new Date(o.targetDate):null,goalCreatedAt:o.goalCreatedAt?new Date(o.goalCreatedAt):new Date,tasks:t.tasks?JSON.parse(t.tasks):o.tasks||[],doneTasks:t.doneTasks?JSON.parse(t.doneTasks):o.doneTasks||[]},e=!0}else{const o=await chrome.storage.sync.get(["goalState","tasks","doneTasks"]);if(o.goalState){console.log("Found old sync storage data, migrating...");const s=JSON.parse(o.goalState);n={goal:s.goal||"My First Project",targetDate:s.targetDate?new Date(s.targetDate):null,goalCreatedAt:s.goalCreatedAt?new Date(s.goalCreatedAt):new Date,tasks:o.tasks?JSON.parse(o.tasks):s.tasks||[],doneTasks:o.doneTasks?JSON.parse(o.doneTasks):s.doneTasks||[]},e=!0}}c={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},e&&(console.log("Creating first project from migrated data"),await g.createProject(n)),await f(),await dt(),console.log("Migration completed successfully")}catch(t){console.error("Migration failed:",t),await _()}}async function _(){console.log("Initializing default multi-project state"),c={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},await f()}async function dt(){try{await chrome.storage.local.remove(["goalState","tasks","doneTasks"]),await chrome.storage.sync.remove(["goalState","tasks","doneTasks","goalSettings"]),console.log("Cleaned up old storage keys")}catch(t){console.log("Could not clean up old storage:",t)}}async function f(){try{await chrome.storage.local.set({projects_data:JSON.stringify(c.projects),global_settings:JSON.stringify(c.globalSettings),active_project:c.activeProjectId,project_order:JSON.stringify(c.projectOrder),migration_version:c.migrationVersion});try{const t={projectIds:Object.keys(c.projects),activeProjectId:c.activeProjectId,globalSettings:c.globalSettings,migrationVersion:c.migrationVersion};await chrome.storage.sync.set({projects_metadata:JSON.stringify(t)})}catch{console.log("Sync storage backup skipped (quota limit)")}}catch(t){throw console.error("Error saving to local storage:",t),t}}function h(){console.log("updateUI called");const t=g.getActiveProject();console.log("Active project in updateUI:",t),t&&t.goal?(a.goalTitle.textContent=`${t.goal}`,E(),console.log("UI updated with project goal:",t.goal)):(a.goalTitle.textContent="Click to set your goal...",R(),console.log("No active project or goal, showing default message")),T(),L(),gt(),ut(),console.log("updateUI completed")}function ut(){const t=g.getActiveProject(),e=t?t.color:"#ffffff",n=document.querySelector(".goal-header h1");n&&(n.style.color=e),document.querySelectorAll(".countdown-number").forEach(r=>{r.style.color="#ffffff"}),document.querySelectorAll(".list-header h2").forEach(r=>{r.style.color="#ffffff"}),document.documentElement.style.setProperty("--project-color",e)}function gt(){const t=g.getActiveProject(),e=g.getActiveProjects();if(t?(a.currentProjectName.textContent=t.goal||"Untitled Project",document.title=`Launch Extension - ${t.goal}`):(a.currentProjectName.textContent="No Project Selected",document.title="Launch Extension"),a.projectList&&(a.projectList.innerHTML="",e.forEach(n=>{const o=document.createElement("div");o.className=`project-item ${n.id===c.activeProjectId?"active":""}`,o.dataset.projectId=n.id,o.innerHTML=`
                <div class="project-color" style="background-color: ${n.color}"></div>
                <div class="project-info">
                    <div class="project-name">${n.goal||"Untitled Project"}</div>
                    <div class="project-meta">
                        ${n.tasks.length} tasks â€¢ ${n.doneTasks.length} done
                    </div>
                </div>
            `,o.addEventListener("click",()=>H(n.id)),a.projectList.appendChild(o)}),e.length===0)){const n=document.createElement("div");n.className="project-empty-state",n.innerHTML=`
                <div style="padding: 1rem; text-align: center; color: rgba(255, 255, 255, 0.6);">
                    No projects yet. Click + to create one!
                </div>
            `,a.projectList.appendChild(n)}}async function H(t){await g.setActiveProject(t),h(),C()}function mt(){a.projectDropdown.classList.toggle("open")}function C(){a.projectDropdown.classList.remove("open")}function pt(){const t=new Date;t.setDate(t.getDate()+1),a.newProjectDate.value=t.toISOString().slice(0,16),a.newProjectName.value="",a.newProjectColor.value="#4CAF50",V(),I("createProjectModal"),setTimeout(()=>a.newProjectName.focus(),100)}async function M(){const t=a.newProjectName.value.trim(),e=a.newProjectDate.value,n=a.newProjectColor.value;if(!t){j("Error","Please enter a project name.");return}if(t.length>50){j("Error","Project name must be 50 characters or less.");return}if(!e){j("Error","Please select a target date.");return}try{const o=await g.createProject({goal:t,targetDate:new Date(e),goalCreatedAt:new Date,color:n});await g.setActiveProject(o.id),h(),C(),k("createProjectModal"),j("Success",`Project "${t}" created successfully!`)}catch(o){console.error("Error creating project:",o),j("Error","Failed to create project. Please try again.")}}function J(t){a.settingsTabs.forEach(o=>o.classList.remove("active")),a.settingsTabContents.forEach(o=>o.classList.remove("active"));const e=document.querySelector(`[data-tab="${t}"]`),n=document.getElementById(`${t}Tab`);e&&e.classList.add("active"),n&&n.classList.add("active")}function U(){if(!a.allProjectsList)return;const t=g.getAllProjects();a.allProjectsList.innerHTML="",t.forEach(o=>{const s=o.id===c.activeProjectId,r=document.createElement("div");r.className=`all-project-item ${s?"active":""}`;const i=o.doneTasks.length>0?Math.round(o.doneTasks.length/(o.tasks.length+o.doneTasks.length)*100):0;r.innerHTML=`
            <div class="all-project-color" style="background-color: ${o.color}"></div>
            <div class="all-project-info">
                <div class="all-project-name">${o.goal||"Untitled Project"}</div>
                <div class="all-project-details">
                    ${o.tasks.length} todo, ${o.doneTasks.length} done (${i}%)
                </div>
            </div>
            <div class="all-project-actions">
                <button class="project-action-btn switch-project-btn" data-project-id="${o.id}">
                    ${s?"Active":"Switch"}
                </button>
                <button class="project-action-btn delete-project-btn" data-project-id="${o.id}">
                    Delete
                </button>
            </div>
        `,a.allProjectsList.appendChild(r)}),t.length===0&&(a.allProjectsList.innerHTML=`
            <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                No projects yet. Create your first project!
            </div>
        `);const e=a.allProjectsList.querySelectorAll(".switch-project-btn"),n=a.allProjectsList.querySelectorAll(".delete-project-btn");e.forEach(o=>{o.addEventListener("click",()=>{const s=o.getAttribute("data-project-id");H(s)})}),n.forEach(o=>{o.addEventListener("click",()=>{const s=o.getAttribute("data-project-id");ft(s)})})}function ft(t){const e=g.getProject(t);e&&yt("Delete Project",`Are you sure you want to delete "${e.goal}"? This action cannot be undone and will delete all tasks.`,async()=>{try{await g.deleteProject(t),h(),U();const n=document.getElementById("importInput");n&&(n.value=""),j("Success","Project deleted successfully.")}catch(n){console.error("Error deleting project:",n),j("Error","Failed to delete project. Please try again.")}})}async function jt(){const t=g.getActiveProject();if(!t||!a.projectColorInput)return;const e=a.projectColorInput.value;await g.updateProject(t.id,{color:e}),h()}function I(t){const e=document.getElementById(t);e&&e.classList.add("show")}function k(t){const e=document.getElementById(t);e&&e.classList.remove("show")}function j(t,e,n="info"){a.notificationTitle.textContent=t,a.notificationMessage.textContent=e;const o=a.notificationModal;o.className="modal",n==="error"?o.classList.add("error"):n==="success"&&o.classList.add("success"),I("notificationModal")}function yt(t,e,n,o=null){a.confirmationTitle.textContent=t,a.confirmationMessage.textContent=e;const s=a.confirmBtn.cloneNode(!0),r=a.cancelConfirmBtn.cloneNode(!0);a.confirmBtn.parentNode.replaceChild(s,a.confirmBtn),a.cancelConfirmBtn.parentNode.replaceChild(r,a.cancelConfirmBtn),a.confirmBtn=s,a.cancelConfirmBtn=r,a.confirmBtn.addEventListener("click",()=>{k("confirmationModal"),n&&n()}),a.cancelConfirmBtn.addEventListener("click",()=>{k("confirmationModal"),o&&o()}),I("confirmationModal")}function V(){if(!a.newProjectName||!a.projectNameCounter)return;const t=a.newProjectName.value.length,e=50;a.projectNameCounter.textContent=t;const n=a.projectNameCounter.parentElement;t>=e?n.style.color="#f44336":t>=e*.8?n.style.color="#ff9800":n.style.color="rgba(255, 255, 255, 0.6)"}function q(){if(!a.goalInput||!a.goalCounter)return;const t=a.goalInput.value.length,e=50;a.goalCounter.textContent=t;const n=a.goalCounter.parentElement;t>=e?n.style.color="#f44336":t>=e*.8?n.style.color="#ff9800":n.style.color="rgba(255, 255, 255, 0.6)"}function R(){a.days.textContent="--",a.hours.textContent="--",a.minutes.textContent="--",a.seconds.textContent="--"}function E(){const t=g.getActiveProject();if(!t||!t.targetDate)return;const e=new Date,n=new Date(t.targetDate);if(e>=n){R();return}const o=tt(n,e),s=et(n,e)%24,r=ot(n,e)%60,i=nt(n,e)%60;a.days.textContent=String(o).padStart(2,"0"),a.hours.textContent=String(s).padStart(2,"0"),a.minutes.textContent=String(r).padStart(2,"0"),a.seconds.textContent=String(i).padStart(2,"0")}function vt(){E(),setInterval(E,1e3)}function ht(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function X(t,e){return{...t,...e,updatedAt:Date.now()}}function b(t){return[...t].sort((e,n)=>n.updatedAt-e.updatedAt)}function x(t,e,n){const o=document.createElement("div");o.className="task-item",o.draggable=!0,o.dataset.index=e,o.dataset.list=n?"done":"todo";const s=document.createElement("h3");if(s.textContent=t.title,o.appendChild(s),t.description){const u=document.createElement("p");u.textContent=t.description,o.appendChild(u)}const r=document.createElement("div");r.className="task-time";const i=kt(t.updatedAt);return r.textContent=`Updated ${i}`,o.appendChild(r),o.addEventListener("dragstart",Dt),o.addEventListener("click",()=>Y(t,e,n)),o}function kt(t){const e=new Date(t),n=new Date,o=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),s=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==n.getFullYear()?"numeric":void 0}),r=y(n),i=y(e),u=new Date(n);u.setDate(u.getDate()-1);const m=y(u);return i===r?`Today at ${o}`:i===m?`Yesterday at ${o}`:`${s} at ${o}`}function T(){if(!a.todoList||!a.doneList)return;a.todoList.innerHTML="",a.doneList.innerHTML="";const t=g.getActiveProject();if(!t)return;const e=b(t.tasks),n=b(t.doneTasks);e.forEach(o=>{const s=t.tasks.findIndex(i=>i===o),r=x(o,s,!1);a.todoList.appendChild(r)}),n.forEach(o=>{const s=t.doneTasks.findIndex(i=>i===o),r=x(o,s,!0);a.doneList.appendChild(r)})}function Y(t=null,e=null,n=!1){v=e,D=n?"done":"todo",t?(a.taskInput.value=t.title,a.taskDescription.value=t.description||""):(a.taskInput.value="",a.taskDescription.value=""),a.deleteTaskBtn&&(v!==null&&!n?a.deleteTaskBtn.style.display="inline-block":a.deleteTaskBtn.style.display="none"),a.taskModal.classList.add("show"),setTimeout(()=>a.taskInput.focus(),100)}function wt(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),z()):t.key==="Escape"&&(t.preventDefault(),w())}function z(){const t=a.taskInput.value.trim(),e=a.taskDescription.value.trim();if(!t)return;const n=g.getActiveProject();if(n){if(v!==null){const o=D==="done"?n.doneTasks:n.tasks,s=o[v];o[v]=X(s,{title:t,description:e})}else n.tasks.push(ht(t,e));f(),T(),w()}}function Pt(){if(v===null)return;const t=g.getActiveProject();if(!t)return;const e=D==="done"?t.doneTasks:t.tasks;Array.isArray(e)&&e.splice(v,1),f(),h(),w()}function w(){a.taskModal.classList.remove("show"),v=null,D=null}function Dt(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function N(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function O(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function $(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;const n=g.getActiveProject();if(!n)return;e.classList.remove("drag-over");const o=JSON.parse(t.dataTransfer.getData("text/plain")),s=o.list==="todo"?n.tasks:n.doneTasks,r=e.id==="todoList"?n.tasks:n.doneTasks;if(s===r)return;const i=s[o.index];i&&(e.id==="doneList"?(i.completedAt=Date.now(),i.updatedAt=Date.now(),K()):e.id==="todoList"&&(delete i.completedAt,i.updatedAt=Date.now()),s.splice(o.index,1),r.push(i),f(),T(),L())}function F(){const t=g.getActiveProject();t&&(t.goal&&(a.goalInput.value=t.goal,q()),t.targetDate&&(a.dateInput.value=new Date(t.targetDate).toISOString().slice(0,16)),a.projectColorInput&&(a.projectColorInput.value=t.color||"#4CAF50")),U(),J("current"),a.settingsModal.classList.add("show")}function P(){a.settingsModal.classList.remove("show")}async function Tt(){const t=a.goalInput.value.trim(),e=a.dateInput.value;if(t&&e){if(t.length>50){j("Error","Goal must be 50 characters or less.");return}let n=g.getActiveProject();if(!n)n=await g.createProject({goal:t,targetDate:new Date(e),goalCreatedAt:new Date});else{const o={goal:t,targetDate:new Date(e)};(!n.goal||n.goal!==t)&&(o.goalCreatedAt=new Date),await g.updateProject(n.id,o)}h(),P()}}function Et(t,e,n){const o=parseInt(t.dataset.index),s=g.getActiveProject();if(!s)return;const r=e==="todo"?s.tasks:s.doneTasks,i=n==="todo"?s.tasks:s.doneTasks,u=r[o];if(u){const m=X(u,{});n==="done"?(m.completedAt=Date.now(),K()):n==="todo"&&delete m.completedAt,r.splice(o,1),i.push(m),f(),T(),L()}}function Ct(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,n=0;const o=50,s=500;function r(m,l){e=m.touches[0].clientX,n=Date.now(),l.classList.add("being-moved")}function i(m,l){const d=m.changedTouches[0].clientX,W=Date.now()-n,S=d-e;l.classList.remove("being-moved");const Q=Math.abs(S)<o&&W<s,Z=Math.abs(S)>o;if(Q||Z){const B=l.closest(".task-list").id==="todoList"?"todo":"done",A=B==="todo"?"done":"todo";t.textContent=`Moving to ${A==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),a.listsContainer.classList.toggle("show-done"),setTimeout(()=>{Et(l,B,A),t.classList.remove("visible")},300)}}function u(m,l){const p=m.touches[0].clientX-e;Math.abs(p)>o&&m.preventDefault()}[a.todoList,a.doneList].forEach(m=>{m.addEventListener("touchstart",l=>{const d=l.target.closest(".task-item");d&&r(l,d)},{passive:!1}),m.addEventListener("touchend",l=>{const d=l.target.closest(".task-item");d&&i(l,d)}),m.addEventListener("touchmove",l=>{l.target.closest(".task-item")&&u(l)},{passive:!1})})}function It(){a.projectDropdownBtn.addEventListener("click",mt),a.addProjectBtn.addEventListener("click",pt),a.settingsTabs.forEach(o=>{o.addEventListener("click",()=>J(o.dataset.tab))}),a.projectColorInput&&a.projectColorInput.addEventListener("change",jt),a.createProjectBtn&&a.createProjectBtn.addEventListener("click",M),a.cancelCreateProjectBtn&&a.cancelCreateProjectBtn.addEventListener("click",()=>k("createProjectModal")),a.closeNotificationBtn&&a.closeNotificationBtn.addEventListener("click",()=>k("notificationModal")),a.newProjectColor&&a.newProjectColor.addEventListener("change",o=>{const s=a.createProjectModal.querySelector(".color-preview");s&&(s.style.backgroundColor=o.target.value)}),a.newProjectName&&(a.newProjectName.addEventListener("keydown",o=>{o.key==="Enter"?(o.preventDefault(),M()):o.key==="Escape"&&(o.preventDefault(),k("createProjectModal"))}),a.newProjectName.addEventListener("input",V)),a.goalInput&&a.goalInput.addEventListener("input",q),document.addEventListener("click",o=>{a.projectDropdown.contains(o.target)||C()}),a.addTaskBtn.addEventListener("click",()=>Y()),a.saveTaskBtn.addEventListener("click",z),a.deleteTaskBtn.addEventListener("click",Pt),a.closeTaskBtn.addEventListener("click",w),a.settingsBtn.addEventListener("click",F),a.closeSettingsBtn.addEventListener("click",P),a.saveSettingsBtn.addEventListener("click",Tt),a.nextList.addEventListener("click",()=>{a.listsContainer.classList.add("show-done")}),a.prevList.addEventListener("click",()=>{a.listsContainer.classList.remove("show-done")}),a.taskInput.addEventListener("keydown",wt),a.taskDescription.addEventListener("keydown",o=>{o.key==="Escape"&&(o.preventDefault(),w())}),Ct(),window.matchMedia("(max-width: 768px)").matches||(a.todoList.addEventListener("dragover",N),a.todoList.addEventListener("dragleave",O),a.todoList.addEventListener("drop",$),a.doneList.addEventListener("dragover",N),a.doneList.addEventListener("dragleave",O),a.doneList.addEventListener("drop",$)),a.goalTitle.addEventListener("click",F),window.addEventListener("click",o=>{o.target===a.taskModal&&w(),o.target===a.settingsModal&&P()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",$t);const e=document.getElementById("importBtn"),n=document.getElementById("importInput");e&&n&&(e.addEventListener("click",()=>n.click()),n.addEventListener("change",o=>{o.target.files.length>0&&Ft(o.target.files[0])}))}function L(){const t=g.getActiveProject();if(!a.activityMatrix||!t||!t.goalCreatedAt)return;const e=Lt(t);Mt(e),Nt(e)}function Lt(t){const e=St(t),n=[];if(!t||!t.goalCreatedAt||!t.targetDate)return n;const o=new Date;o.setHours(23,59,59,999);const s=new Date(t.targetDate);s.setHours(23,59,59,999);const r=s>o?s:o,i=new Date(e);for(;i<=r;){const u=y(i),m=Bt(u,t),l=y(new Date)===u,d=i>new Date;n.push({date:new Date(i),dateStr:u,count:m,level:d&&!l?-1:At(m),dayOfWeek:i.getDay(),isToday:l,isFuture:d&&!l}),i.setDate(i.getDate()+1)}return n}function St(t){let e=t.goalCreatedAt?new Date(t.goalCreatedAt):new Date;const n=[...t.tasks,...t.doneTasks];if(n.length>0){const o=Math.min(...n.map(r=>r.createdAt||Date.now())),s=new Date(o);s<e&&(e=s)}return e.setHours(0,0,0,0),e}function y(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${o}`}function Bt(t,e){return e.doneTasks.filter(n=>{if(!n.completedAt)return!1;const o=new Date(n.completedAt);return y(o)===t}).length}function At(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function Mt(t){a.activityMatrix.innerHTML="",t.forEach(e=>{const n=document.createElement("div");let o="matrix-day";e.level===-1?o+=" matrix-day-future":o+=` matrix-day-${e.level}`,e.isToday&&(o+=" matrix-day-today"),n.className=o,n.dataset.date=e.dateStr,n.dataset.count=e.count,n.addEventListener("mouseenter",bt),n.addEventListener("mouseleave",xt),n.addEventListener("mousemove",G),a.activityMatrix.appendChild(n)})}function bt(t){const e=t.target,n=e.dataset.date,o=parseInt(e.dataset.count),r=y(new Date),i=n===r,u=new Date(n+"T00:00:00"),m=n>r,l=u.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});let d;m&&!i?d=`No activity yet on ${l}`:i?d=`${o} ${o===1?"task":"tasks"} completed today`:d=`${o} ${o===1?"task":"tasks"} completed on ${l}`,a.activityTooltip.textContent=d,a.activityTooltip.classList.add("visible"),G(t)}function xt(){a.activityTooltip.classList.remove("visible")}function G(t){const e=a.activityTooltip.getBoundingClientRect();let n=t.clientY+20,o=t.clientX+10;o+e.width>window.innerWidth-8&&(o=t.clientX-e.width-10),n+e.height>window.innerHeight-8&&(n=t.clientY-e.height-10),a.activityTooltip.style.position="fixed",a.activityTooltip.style.top=`${n}px`,a.activityTooltip.style.left=`${o}px`}function Nt(t){if(!a.activityStats)return;const n=t.filter(r=>!r.isFuture).filter(r=>r.count>0).length,o=t.reduce((r,i)=>r+i.count,0),s=Ot(t);a.activityStats.textContent=`${o} tasks completed across ${n} days (${s} day streak)`}function Ot(t){let e=0;const n=new Date;n.setHours(0,0,0,0);const o=y(n);let s=-1;for(let r=t.length-1;r>=0;r--)if(t[r].dateStr===o){s=r;break}if(s===-1){for(let r=t.length-1;r>=0;r--)if(!t[r].isFuture&&t[r].count>0)e++;else if(!t[r].isFuture)break;return e}for(let r=s;r>=0&&t[r].count>0;r--)e++;return e}function $t(){console.log("Exporting data..."),console.log("Current state:",{projectCount:Object.keys(c.projects||{}).length,activeProjectId:c.activeProjectId,migrationVersion:c.migrationVersion});const t={version:"1.0",exportDate:new Date().toISOString(),data:{projects:c.projects,activeProjectId:c.activeProjectId,projectOrder:c.projectOrder,globalSettings:c.globalSettings,migrationVersion:c.migrationVersion}};console.log("Export data prepared:",{projectCount:Object.keys(t.data.projects||{}).length,dataSize:JSON.stringify(t).length});const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=`launch-ext-backup-${y(new Date)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),console.log("Export completed")}async function Ft(t){var e,n;try{const o=await t.text(),s=JSON.parse(o);if(console.log("Import data structure:",s),!s.version||!s.data)throw new Error("Invalid backup file format");if(s.data.projects){console.log("Importing multi-project data");const l=s.data.projects;Object.keys(l).forEach(d=>{const p=l[d];p.targetDate&&typeof p.targetDate=="string"&&(p.targetDate=new Date(p.targetDate)),p.goalCreatedAt&&typeof p.goalCreatedAt=="string"&&(p.goalCreatedAt=new Date(p.goalCreatedAt)),console.log(`Fixed dates for project ${d}:`,{goal:p.goal,targetDate:p.targetDate,goalCreatedAt:p.goalCreatedAt})}),c.projects=l,c.activeProjectId=s.data.activeProjectId,c.projectOrder=s.data.projectOrder||Object.keys(s.data.projects),c.globalSettings={...c.globalSettings,...s.data.globalSettings||{}}}else{console.log("Converting old single-project data to multi-project format"),console.log("Import data details:",{goal:s.data.goal,targetDate:s.data.targetDate,tasksCount:(e=s.data.tasks)==null?void 0:e.length,doneTasksCount:(n=s.data.doneTasks)==null?void 0:n.length});const l=g.generateProjectId(),d={id:l,goal:s.data.goal||"Imported Project",targetDate:s.data.targetDate?new Date(s.data.targetDate):null,goalCreatedAt:s.data.goalCreatedAt?new Date(s.data.goalCreatedAt):new Date,tasks:Array.isArray(s.data.tasks)?s.data.tasks:[],doneTasks:Array.isArray(s.data.doneTasks)?s.data.doneTasks:[],color:"#4CAF50",isActive:!0,order:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};console.log("Created new project:",d),c.projects={},c.projects[l]=d,c.activeProjectId=l,c.projectOrder=[l],console.log("Created new project from old format:",d)}c.migrationVersion=2,console.log("Final state after import:",{projectCount:Object.keys(c.projects).length,activeProjectId:c.activeProjectId,projects:Object.keys(c.projects).map(l=>({id:l,goal:c.projects[l].goal,tasksCount:c.projects[l].tasks.length,doneTasksCount:c.projects[l].doneTasks.length}))}),console.log("Saving imported state to storage..."),console.log("State before saving:",{projectCount:Object.keys(c.projects).length,activeProjectId:c.activeProjectId,migrationVersion:c.migrationVersion}),await f(),console.log("State saved successfully"),g.state=c,console.log("ProjectManager state updated"),h(),P();const r=document.getElementById("importInput");r&&(r.value="");const i=Object.keys(c.projects).length,u=g.getActiveProject(),m=u?`${u.tasks.length} todo tasks, ${u.doneTasks.length} completed tasks`:"No active project";j("Import Successful",`${i} project(s) imported successfully!
${m}`,"success")}catch(o){console.error("Import error:",o);const s=document.getElementById("importInput");s&&(s.value=""),j("Import Failed",`Error importing data: ${o.message}
Please check the console for details.`,"error")}}function K(){const t=document.createElement("div");t.className="confetti-container",document.body.appendChild(t);const e=["#ff6b6b","#ff9500","#ffdd00","#4ecdc4","#45b7d1","#eb4d4b","#6c5ce7","#a29bfe"],n=["#ffff00","#ffffff","#ff8800","#ff4444"];for(let o=0;o<60;o++){const s=document.createElement("div");s.className="confetti";const r=Math.PI*2*o/60,i=200+Math.random()*300,u=e[Math.floor(Math.random()*e.length)];s.style.backgroundColor=u,s.style.setProperty("--burst-x",Math.cos(r)*i+"px"),s.style.setProperty("--burst-y",Math.sin(r)*i+"px"),s.style.animationDelay=Math.random()*.15+"s",s.style.animationDuration=2+Math.random()*1.5+"s",t.appendChild(s)}for(let o=0;o<40;o++){const s=document.createElement("div");s.className="confetti secondary";const r=Math.random()*Math.PI*2,i=150+Math.random()*200,u=e[Math.floor(Math.random()*e.length)];s.style.backgroundColor=u,s.style.setProperty("--burst-x",Math.cos(r)*i+"px"),s.style.setProperty("--burst-y",Math.sin(r)*i+"px"),s.style.animationDelay=.1+Math.random()*.2+"s",s.style.animationDuration=2.5+Math.random()*1+"s",t.appendChild(s)}for(let o=0;o<80;o++){const s=document.createElement("div");s.className="spark";const r=Math.random()*Math.PI*2,i=100+Math.random()*250,u=n[Math.floor(Math.random()*n.length)];s.style.backgroundColor=u,s.style.setProperty("--burst-x",Math.cos(r)*i+"px"),s.style.setProperty("--burst-y",Math.sin(r)*i+"px"),s.style.animationDelay=Math.random()*.3+"s",s.style.animationDuration=1.2+Math.random()*1+"s",t.appendChild(s)}setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},3e3)}st();

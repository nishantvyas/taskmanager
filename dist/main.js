(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function et(t,e){const n=t.getTime()-e.getTime();return Math.ceil(n/(1e3*60*60*24))}function ot(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60*60))}function nt(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60))}function at(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/1e3)}let i={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};class st{constructor(){this.state=i}generateProjectId(){return"project_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async createProject(e){const n=this.generateProjectId(),o={id:n,goal:e.goal||"New Project",targetDate:e.targetDate||null,goalCreatedAt:e.goalCreatedAt||new Date,tasks:e.tasks||[],doneTasks:e.doneTasks||[],color:e.color||this.state.globalSettings.defaultProjectColor,isActive:!0,isCompleted:e.isCompleted||!1,completedAt:e.completedAt||null,order:this.state.projectOrder.length,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.state.projects[n]=o,this.state.projectOrder.push(n),this.state.activeProjectId||(this.state.activeProjectId=n),await y(),o}getProject(e){return this.state.projects[e]||null}async updateProject(e,n){return this.state.projects[e]?(this.state.projects[e]={...this.state.projects[e],...n,updatedAt:new Date().toISOString()},await y(),this.state.projects[e]):null}async deleteProject(e){return this.state.projects[e]?(delete this.state.projects[e],this.state.projectOrder=this.state.projectOrder.filter(n=>n!==e),this.state.activeProjectId===e&&(this.state.activeProjectId=this.state.projectOrder.length>0?this.state.projectOrder[0]:null),await y(),!0):!1}getActiveProject(){return this.state.activeProjectId?this.state.projects[this.state.activeProjectId]:null}async setActiveProject(e){return this.state.projects[e]?(this.state.activeProjectId=e,await y(),!0):!1}getAllProjects(){return this.state.projectOrder.map(e=>this.state.projects[e]).filter(Boolean)}getActiveProjects(){return this.getAllProjects().filter(e=>e.isActive)}}const g=new st,a={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),deleteTaskBtn:document.getElementById("deleteTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip"),projectDropdownBtn:document.getElementById("projectDropdownBtn"),projectDropdownMenu:document.getElementById("projectDropdownMenu"),currentProjectName:document.getElementById("currentProjectName"),addProjectBtn:document.getElementById("addProjectBtn"),projectList:document.getElementById("projectList"),projectDropdown:document.querySelector(".project-dropdown"),settingsTabs:document.querySelectorAll(".settings-tab"),settingsTabContents:document.querySelectorAll(".settings-tab-content"),projectColorInput:document.getElementById("projectColorInput"),toggleCompleteBtn:document.getElementById("toggleCompleteBtn"),statusIndicator:document.getElementById("statusIndicator"),allProjectsList:document.getElementById("allProjectsList"),createProjectModal:document.getElementById("createProjectModal"),newProjectName:document.getElementById("newProjectName"),newProjectDate:document.getElementById("newProjectDate"),newProjectColor:document.getElementById("newProjectColor"),createProjectBtn:document.getElementById("createProjectBtn"),cancelCreateProjectBtn:document.getElementById("cancelCreateProjectBtn"),confirmationModal:document.getElementById("confirmationModal"),confirmationTitle:document.getElementById("confirmationTitle"),confirmationMessage:document.getElementById("confirmationMessage"),confirmBtn:document.getElementById("confirmBtn"),cancelConfirmBtn:document.getElementById("cancelConfirmBtn"),notificationModal:document.getElementById("notificationModal"),notificationTitle:document.getElementById("notificationTitle"),notificationMessage:document.getElementById("notificationMessage"),closeNotificationBtn:document.getElementById("closeNotificationBtn"),projectNameCounter:document.getElementById("projectNameCounter"),goalCounter:document.getElementById("goalCounter")};let h=null,D=null;async function rt(){await lt(),ct(),v(),Lt(),ht()}function ct(){let t=!1;i.doneTasks.forEach(e=>{e.completedAt&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),i.tasks.forEach(e=>{(e.createdAt||e.updatedAt)&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),t&&(console.log("Marked tasks as migrated to new timezone handling"),y())}function it(){if(!i.projects)return;const t=new Date,e=new Date(t.getTime()-90*24*60*60*1e3);let n=0;Object.keys(i.projects).forEach(o=>{const s=i.projects[o];if(!Array.isArray(s.doneTasks)||s.doneTasks.length<=1e3)return;const c=[...s.doneTasks].sort((u,p)=>new Date(p.completedAt||p.updatedAt||p.createdAt)-new Date(u.completedAt||u.updatedAt||u.createdAt)).slice(0,1e3),l=new Set(c.map(u=>u.id)),m=s.doneTasks.filter(u=>l.has(u.id)?!1:new Date(u.completedAt||u.updatedAt||u.createdAt)>=e),d=[...c,...m];if(d.length<s.doneTasks.length){const u=s.doneTasks.length-d.length;n+=u,s.doneTasks=d}}),n>0&&(console.log(`Cleaned up ${n} old completed tasks across all projects`),y())}async function lt(){try{const t=await chrome.storage.local.get(["projects_data","global_settings","active_project","project_order","migration_version"]);if(t.migration_version===2&&t.projects_data){console.log("Loading multi-project data"),console.log("Raw projects_data:",t.projects_data);try{const e=JSON.parse(t.projects_data);console.log("Parsed projects:",e),console.log("Number of projects:",Object.keys(e).length),i={projects:e,activeProjectId:t.active_project,projectOrder:JSON.parse(t.project_order||"[]"),globalSettings:JSON.parse(t.global_settings||"{}"),migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},console.log("Loaded state:",{projectCount:Object.keys(i.projects).length,activeProjectId:i.activeProjectId,projectOrder:i.projectOrder})}catch(e){throw console.error("Error parsing projects data:",e),console.log("Corrupted projects_data:",t.projects_data),e}i.globalSettings={theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10,...i.globalSettings},g.state=i,console.log("ProjectManager state updated after loading")}else console.log("Checking for single-project data to migrate"),await dt();it(),g.state=i,console.log("Final ProjectManager state sync after loadState")}catch(t){console.error("Error loading state:",t),await U()}}async function dt(){console.log("Starting migration to multi-project structure");try{const t=await chrome.storage.local.get(["goalState","tasks","doneTasks"]);let e=!1,n={goal:"My First Project",targetDate:null,goalCreatedAt:new Date,tasks:[],doneTasks:[]};if(t.goalState){console.log("Found old single-project data, migrating...");const o=JSON.parse(t.goalState);n={goal:o.goal||"My First Project",targetDate:o.targetDate?new Date(o.targetDate):null,goalCreatedAt:o.goalCreatedAt?new Date(o.goalCreatedAt):new Date,tasks:t.tasks?JSON.parse(t.tasks):o.tasks||[],doneTasks:t.doneTasks?JSON.parse(t.doneTasks):o.doneTasks||[]},e=!0}else{const o=await chrome.storage.sync.get(["goalState","tasks","doneTasks"]);if(o.goalState){console.log("Found old sync storage data, migrating...");const s=JSON.parse(o.goalState);n={goal:s.goal||"My First Project",targetDate:s.targetDate?new Date(s.targetDate):null,goalCreatedAt:s.goalCreatedAt?new Date(s.goalCreatedAt):new Date,tasks:o.tasks?JSON.parse(o.tasks):s.tasks||[],doneTasks:o.doneTasks?JSON.parse(o.doneTasks):s.doneTasks||[]},e=!0}}i={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},e&&(console.log("Creating first project from migrated data"),await g.createProject(n)),await y(),await ut(),console.log("Migration completed successfully")}catch(t){console.error("Migration failed:",t),await U()}}async function U(){console.log("Initializing default multi-project state"),i={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},await y()}async function ut(){try{await chrome.storage.local.remove(["goalState","tasks","doneTasks"]),await chrome.storage.sync.remove(["goalState","tasks","doneTasks","goalSettings"]),console.log("Cleaned up old storage keys")}catch(t){console.log("Could not clean up old storage:",t)}}async function y(){try{await chrome.storage.local.set({projects_data:JSON.stringify(i.projects),global_settings:JSON.stringify(i.globalSettings),active_project:i.activeProjectId,project_order:JSON.stringify(i.projectOrder),migration_version:i.migrationVersion});try{const t={projectIds:Object.keys(i.projects),activeProjectId:i.activeProjectId,globalSettings:i.globalSettings,migrationVersion:i.migrationVersion};await chrome.storage.sync.set({projects_metadata:JSON.stringify(t)})}catch{console.log("Sync storage backup skipped (quota limit)")}}catch(t){throw console.error("Error saving to local storage:",t),t}}function v(){console.log("updateUI called");const t=g.getActiveProject();console.log("Active project in updateUI:",t),t&&t.goal?(a.goalTitle.textContent=`${t.goal}`,T(),console.log("UI updated with project goal:",t.goal)):(a.goalTitle.textContent="Click to set your goal...",Y(),console.log("No active project or goal, showing default message")),E(),A(),mt(),gt(),console.log("updateUI completed")}function gt(){const t=g.getActiveProject(),e=t?t.color:"#ffffff",n=document.querySelector(".goal-header h1");n&&(n.style.color=e),document.querySelectorAll(".countdown-number").forEach(r=>{r.style.color="#ffffff"}),document.querySelectorAll(".list-header h2").forEach(r=>{r.style.color="#ffffff"}),document.documentElement.style.setProperty("--project-color",e)}function mt(){const t=g.getActiveProject(),e=g.getActiveProjects();if(t?(a.currentProjectName.textContent=t.goal||"Untitled Project",document.title=`Launch Extension - ${t.goal}`):(a.currentProjectName.textContent="No Project Selected",document.title="Launch Extension"),a.projectList&&(a.projectList.innerHTML="",e.forEach(n=>{const o=document.createElement("div");o.className=`project-item ${n.id===i.activeProjectId?"active":""}`,o.dataset.projectId=n.id,o.innerHTML=`
                <div class="project-color" style="background-color: ${n.color}"></div>
                <div class="project-info">
                    <div class="project-name">${n.goal||"Untitled Project"}</div>
                    <div class="project-meta">
                        ${n.tasks.length} tasks â€¢ ${n.doneTasks.length} done
                    </div>
                </div>
            `,o.addEventListener("click",()=>V(n.id)),a.projectList.appendChild(o)}),e.length===0)){const n=document.createElement("div");n.className="project-empty-state",n.innerHTML=`
                <div style="padding: 1rem; text-align: center; color: rgba(255, 255, 255, 0.6);">
                    No projects yet. Click + to create one!
                </div>
            `,a.projectList.appendChild(n)}}async function V(t){await g.setActiveProject(t),v(),L(),B(),I()}function pt(){a.projectDropdown.classList.toggle("open")}function I(){a.projectDropdown.classList.remove("open")}function ft(){const t=new Date;t.setDate(t.getDate()+1),a.newProjectDate.value=t.toISOString().slice(0,16),a.newProjectName.value="",a.newProjectColor.value="#4CAF50",R(),S("createProjectModal"),setTimeout(()=>a.newProjectName.focus(),100)}async function N(){const t=a.newProjectName.value.trim(),e=a.newProjectDate.value,n=a.newProjectColor.value;if(!t){f("Error","Please enter a project name.");return}if(t.length>50){f("Error","Project name must be 50 characters or less.");return}if(!e){f("Error","Please select a target date.");return}try{const o=await g.createProject({goal:t,targetDate:new Date(e),goalCreatedAt:new Date,color:n});await g.setActiveProject(o.id),v(),I(),P("createProjectModal"),f("Success",`Project "${t}" created successfully!`)}catch(o){console.error("Error creating project:",o),f("Error","Failed to create project. Please try again.")}}function q(t){a.settingsTabs.forEach(o=>o.classList.remove("active")),a.settingsTabContents.forEach(o=>o.classList.remove("active"));const e=document.querySelector(`[data-tab="${t}"]`),n=document.getElementById(`${t}Tab`);e&&e.classList.add("active"),n&&n.classList.add("active")}function L(){if(!a.allProjectsList)return;const t=g.getAllProjects();a.allProjectsList.innerHTML="",t.forEach(o=>{const s=o.id===i.activeProjectId,r=document.createElement("div");r.className=`all-project-item ${s?"active":""}`,r.setAttribute("data-project-id",o.id),s&&(r.style.borderColor=o.color);const c=o.doneTasks.length>0?Math.round(o.doneTasks.length/(o.tasks.length+o.doneTasks.length)*100):0;r.innerHTML=`
            <div class="all-project-color" style="background-color: ${o.color}"></div>
            <div class="all-project-info">
                <div class="all-project-name">${o.goal||"Untitled Project"}</div>
                <div class="all-project-details">
                    ${o.tasks.length} todo, ${o.doneTasks.length} done (${c}%)
                    ${s?" â€¢ Active":""}
                </div>
            </div>
            <div class="all-project-actions">
                <button class="project-action-btn delete-project-btn" data-project-id="${o.id}">
                    Delete
                </button>
            </div>
        `,a.allProjectsList.appendChild(r)}),t.length===0&&(a.allProjectsList.innerHTML=`
            <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                No projects yet. Create your first project!
            </div>
        `);const e=a.allProjectsList.querySelectorAll(".all-project-item"),n=a.allProjectsList.querySelectorAll(".delete-project-btn");e.forEach(o=>{o.addEventListener("click",s=>{if(s.target.classList.contains("delete-project-btn"))return;const r=o.getAttribute("data-project-id");r&&r!==i.activeProjectId&&V(r)}),o.style.cursor="pointer"}),n.forEach(o=>{o.addEventListener("click",s=>{s.stopPropagation();const r=o.getAttribute("data-project-id");yt(r)})})}function yt(t){const e=g.getProject(t);e&&vt("Delete Project",`Are you sure you want to delete "${e.goal}"? This action cannot be undone and will delete all tasks.`,async()=>{try{await g.deleteProject(t),v(),L();const n=document.getElementById("importInput");n&&(n.value=""),f("Success","Project deleted successfully.")}catch(n){console.error("Error deleting project:",n),f("Error","Failed to delete project. Please try again.")}})}async function jt(){const t=g.getActiveProject();if(!t||!a.projectColorInput)return;const e=a.projectColorInput.value;await g.updateProject(t.id,{color:e}),v()}function S(t){const e=document.getElementById(t);e&&e.classList.add("show")}function P(t){const e=document.getElementById(t);e&&e.classList.remove("show")}function f(t,e,n="info"){a.notificationTitle.textContent=t,a.notificationMessage.textContent=e;const o=a.notificationModal;o.className="modal",n==="error"?o.classList.add("error"):n==="success"&&o.classList.add("success"),S("notificationModal")}function vt(t,e,n,o=null){a.confirmationTitle.textContent=t,a.confirmationMessage.textContent=e;const s=a.confirmBtn.cloneNode(!0),r=a.cancelConfirmBtn.cloneNode(!0);a.confirmBtn.parentNode.replaceChild(s,a.confirmBtn),a.cancelConfirmBtn.parentNode.replaceChild(r,a.cancelConfirmBtn),a.confirmBtn=s,a.cancelConfirmBtn=r,a.confirmBtn.addEventListener("click",()=>{P("confirmationModal"),n&&n()}),a.cancelConfirmBtn.addEventListener("click",()=>{P("confirmationModal"),o&&o()}),S("confirmationModal")}function R(){if(!a.newProjectName||!a.projectNameCounter)return;const t=a.newProjectName.value.length,e=50;a.projectNameCounter.textContent=t;const n=a.projectNameCounter.parentElement;t>=e?n.style.color="#f44336":t>=e*.8?n.style.color="#ff9800":n.style.color="rgba(255, 255, 255, 0.6)"}function X(){if(!a.goalInput||!a.goalCounter)return;const t=a.goalInput.value.length,e=50;a.goalCounter.textContent=t;const n=a.goalCounter.parentElement;t>=e?n.style.color="#f44336":t>=e*.8?n.style.color="#ff9800":n.style.color="rgba(255, 255, 255, 0.6)"}function Y(){a.days.textContent="--",a.hours.textContent="--",a.minutes.textContent="--",a.seconds.textContent="--"}function T(){const t=g.getActiveProject();if(!t||!t.targetDate)return;if(t.isCompleted){a.days.textContent="DONE",a.hours.textContent="âœ“",a.minutes.textContent="âœ“",a.seconds.textContent="âœ“";return}const e=new Date,n=new Date(t.targetDate);if(e>=n){Y();return}const o=et(n,e),s=ot(n,e)%24,r=nt(n,e)%60,c=at(n,e)%60;a.days.textContent=String(o).padStart(2,"0"),a.hours.textContent=String(s).padStart(2,"0"),a.minutes.textContent=String(r).padStart(2,"0"),a.seconds.textContent=String(c).padStart(2,"0")}function ht(){T(),setInterval(T,1e3)}function kt(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function z(t,e){return{...t,...e,updatedAt:Date.now()}}function O(t){return[...t].sort((e,n)=>n.updatedAt-e.updatedAt)}function $(t,e,n){const o=document.createElement("div");o.className="task-item",o.draggable=!0,o.dataset.index=e,o.dataset.list=n?"done":"todo";const s=document.createElement("h3");if(s.textContent=t.title,o.appendChild(s),t.description){const l=document.createElement("p");l.textContent=t.description,o.appendChild(l)}const r=document.createElement("div");r.className="task-time";const c=Pt(t.updatedAt);return r.textContent=`Updated ${c}`,o.appendChild(r),o.addEventListener("dragstart",Dt),o.addEventListener("click",()=>G(t,e,n)),o}function Pt(t){const e=new Date(t),n=new Date,o=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),s=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==n.getFullYear()?"numeric":void 0}),r=j(n),c=j(e),l=new Date(n);l.setDate(l.getDate()-1);const m=j(l);return c===r?`Today at ${o}`:c===m?`Yesterday at ${o}`:`${s} at ${o}`}function E(){if(!a.todoList||!a.doneList)return;a.todoList.innerHTML="",a.doneList.innerHTML="";const t=g.getActiveProject();if(!t)return;const e=O(t.tasks),n=O(t.doneTasks);e.forEach(o=>{const s=t.tasks.findIndex(c=>c===o),r=$(o,s,!1);a.todoList.appendChild(r)}),n.forEach(o=>{const s=t.doneTasks.findIndex(c=>c===o),r=$(o,s,!0);a.doneList.appendChild(r)})}function G(t=null,e=null,n=!1){h=e,D=n?"done":"todo",t?(a.taskInput.value=t.title,a.taskDescription.value=t.description||""):(a.taskInput.value="",a.taskDescription.value=""),a.deleteTaskBtn&&(h!==null&&!n?a.deleteTaskBtn.style.display="inline-block":a.deleteTaskBtn.style.display="none"),a.taskModal.classList.add("show"),setTimeout(()=>a.taskInput.focus(),100)}function Ct(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),K()):t.key==="Escape"&&(t.preventDefault(),C())}function K(){const t=a.taskInput.value.trim(),e=a.taskDescription.value.trim();if(!t)return;const n=g.getActiveProject();if(n){if(h!==null){const o=D==="done"?n.doneTasks:n.tasks,s=o[h];o[h]=z(s,{title:t,description:e})}else n.tasks.push(kt(t,e));y(),E(),C()}}function wt(){if(h===null)return;const t=g.getActiveProject();if(!t)return;const e=D==="done"?t.doneTasks:t.tasks;Array.isArray(e)&&e.splice(h,1),y(),v(),C()}function C(){a.taskModal.classList.remove("show"),h=null,D=null}function Dt(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function F(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function _(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function H(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;const n=g.getActiveProject();if(!n)return;e.classList.remove("drag-over");const o=JSON.parse(t.dataTransfer.getData("text/plain")),s=o.list==="todo"?n.tasks:n.doneTasks,r=e.id==="todoList"?n.tasks:n.doneTasks;if(s===r)return;const c=s[o.index];c&&(e.id==="doneList"?(c.completedAt=Date.now(),c.updatedAt=Date.now(),Q()):e.id==="todoList"&&(delete c.completedAt,c.updatedAt=Date.now()),s.splice(o.index,1),r.push(c),y(),E(),A())}function J(){const t=g.getActiveProject();t&&(t.goal&&(a.goalInput.value=t.goal,X()),t.targetDate&&(a.dateInput.value=new Date(t.targetDate).toISOString().slice(0,16)),a.projectColorInput&&(a.projectColorInput.value=t.color||"#4CAF50")),L(),B(),q("current"),a.settingsModal.classList.add("show")}function w(){a.settingsModal.classList.remove("show")}async function Et(){const t=a.goalInput.value.trim(),e=a.dateInput.value;if(t&&e){if(t.length>50){f("Error","Goal must be 50 characters or less.");return}let n=g.getActiveProject();if(!n)n=await g.createProject({goal:t,targetDate:new Date(e),goalCreatedAt:new Date});else{const o={goal:t,targetDate:new Date(e)};(!n.goal||n.goal!==t)&&(o.goalCreatedAt=new Date),await g.updateProject(n.id,o)}v(),w()}}function Tt(t,e,n){const o=parseInt(t.dataset.index),s=g.getActiveProject();if(!s)return;const r=e==="todo"?s.tasks:s.doneTasks,c=n==="todo"?s.tasks:s.doneTasks,l=r[o];if(l){const m=z(l,{});n==="done"?(m.completedAt=Date.now(),Q()):n==="todo"&&delete m.completedAt,r.splice(o,1),c.push(m),y(),E(),A()}}function It(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,n=0;const o=50,s=500;function r(m,d){e=m.touches[0].clientX,n=Date.now(),d.classList.add("being-moved")}function c(m,d){const u=m.changedTouches[0].clientX,k=Date.now()-n,M=u-e;d.classList.remove("being-moved");const Z=Math.abs(M)<o&&k<s,tt=Math.abs(M)>o;if(Z||tt){const b=d.closest(".task-list").id==="todoList"?"todo":"done",x=b==="todo"?"done":"todo";t.textContent=`Moving to ${x==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),a.listsContainer.classList.toggle("show-done"),setTimeout(()=>{Tt(d,b,x),t.classList.remove("visible")},300)}}function l(m,d){const p=m.touches[0].clientX-e;Math.abs(p)>o&&m.preventDefault()}[a.todoList,a.doneList].forEach(m=>{m.addEventListener("touchstart",d=>{const u=d.target.closest(".task-item");u&&r(d,u)},{passive:!1}),m.addEventListener("touchend",d=>{const u=d.target.closest(".task-item");u&&c(d,u)}),m.addEventListener("touchmove",d=>{d.target.closest(".task-item")&&l(d)},{passive:!1})})}function Lt(){a.projectDropdownBtn.addEventListener("click",pt),a.addProjectBtn.addEventListener("click",ft),a.settingsTabs.forEach(o=>{o.addEventListener("click",()=>q(o.dataset.tab))}),a.projectColorInput&&a.projectColorInput.addEventListener("change",jt),a.createProjectBtn&&a.createProjectBtn.addEventListener("click",N),a.cancelCreateProjectBtn&&a.cancelCreateProjectBtn.addEventListener("click",()=>P("createProjectModal")),a.closeNotificationBtn&&a.closeNotificationBtn.addEventListener("click",()=>P("notificationModal")),a.newProjectColor&&a.newProjectColor.addEventListener("change",o=>{const s=a.createProjectModal.querySelector(".color-preview");s&&(s.style.backgroundColor=o.target.value)}),a.newProjectName&&(a.newProjectName.addEventListener("keydown",o=>{o.key==="Enter"?(o.preventDefault(),N()):o.key==="Escape"&&(o.preventDefault(),P("createProjectModal"))}),a.newProjectName.addEventListener("input",R)),a.goalInput&&a.goalInput.addEventListener("input",X),document.addEventListener("click",o=>{a.projectDropdown.contains(o.target)||I()}),a.addTaskBtn.addEventListener("click",()=>G()),a.saveTaskBtn.addEventListener("click",K),a.deleteTaskBtn.addEventListener("click",wt),a.closeTaskBtn.addEventListener("click",C),a.settingsBtn.addEventListener("click",J),a.closeSettingsBtn.addEventListener("click",w),a.saveSettingsBtn.addEventListener("click",Et),a.toggleCompleteBtn.addEventListener("click",Ht),a.nextList.addEventListener("click",()=>{a.listsContainer.classList.add("show-done")}),a.prevList.addEventListener("click",()=>{a.listsContainer.classList.remove("show-done")}),a.taskInput.addEventListener("keydown",Ct),a.taskDescription.addEventListener("keydown",o=>{o.key==="Escape"&&(o.preventDefault(),C())}),It(),window.matchMedia("(max-width: 768px)").matches||(a.todoList.addEventListener("dragover",F),a.todoList.addEventListener("dragleave",_),a.todoList.addEventListener("drop",H),a.doneList.addEventListener("dragover",F),a.doneList.addEventListener("dragleave",_),a.doneList.addEventListener("drop",H)),a.goalTitle.addEventListener("click",J),window.addEventListener("click",o=>{o.target===a.taskModal&&C(),o.target===a.settingsModal&&w()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",Ft);const e=document.getElementById("importBtn"),n=document.getElementById("importInput");e&&n&&(e.addEventListener("click",()=>n.click()),n.addEventListener("change",o=>{o.target.files.length>0&&_t(o.target.files[0])}))}function A(){const t=g.getActiveProject();if(!a.activityMatrix||!t||!t.goalCreatedAt)return;const e=St(t);bt(e),Ot(e)}function St(t){const e=At(t),n=[];if(!t||!t.goalCreatedAt||!t.targetDate)return n;const o=new Date;o.setHours(23,59,59,999);const s=new Date(t.targetDate);s.setHours(23,59,59,999);let r;if(t.isCompleted&&t.completedAt){const l=new Date(t.completedAt);l.setHours(23,59,59,999),r=l}else r=s>o?s:o;const c=new Date(e);for(;c<=r;){const l=j(c),m=Bt(l,t),d=j(new Date)===l,u=c>new Date,p=t.isCompleted&&t.completedAt&&j(new Date(t.completedAt))===l;n.push({date:new Date(c),dateStr:l,count:m,level:u&&!d?-1:Mt(m),dayOfWeek:c.getDay(),isToday:d,isFuture:u&&!d,isCompletionDate:p}),c.setDate(c.getDate()+1)}return n}function At(t){let e=t.goalCreatedAt?new Date(t.goalCreatedAt):new Date;const n=[...t.tasks,...t.doneTasks];if(n.length>0){const o=Math.min(...n.map(r=>r.createdAt||Date.now())),s=new Date(o);s<e&&(e=s)}return e.setHours(0,0,0,0),e}function j(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${o}`}function Bt(t,e){return e.doneTasks.filter(n=>{if(!n.completedAt)return!1;const o=new Date(n.completedAt);return j(o)===t}).length}function Mt(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function bt(t){a.activityMatrix.innerHTML="",t.forEach(e=>{const n=document.createElement("div");let o="matrix-day";e.level===-1?o+=" matrix-day-future":o+=` matrix-day-${e.level}`,e.isToday&&(o+=" matrix-day-today"),e.isCompletionDate&&(o+=" matrix-day-completion"),n.className=o,n.dataset.date=e.dateStr,n.dataset.count=e.count,n.addEventListener("mouseenter",xt),n.addEventListener("mouseleave",Nt),n.addEventListener("mousemove",W),a.activityMatrix.appendChild(n)})}function xt(t){const e=t.target,n=e.dataset.date,o=parseInt(e.dataset.count),r=j(new Date),c=n===r,l=new Date(n+"T00:00:00"),m=n>r,d=e.classList.contains("matrix-day-completion"),u=l.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});let p;if(d)p=`ðŸ† Project completed on ${u} (${o} ${o===1?"task":"tasks"} done)`;else if(m&&!c){const k=g.getActiveProject();k&&k.isCompleted?p="Project was completed - no further progress tracked":p=`No activity yet on ${u}`}else c?p=`${o} ${o===1?"task":"tasks"} completed today`:p=`${o} ${o===1?"task":"tasks"} completed on ${u}`;a.activityTooltip.textContent=p,a.activityTooltip.classList.add("visible"),W(t)}function Nt(){a.activityTooltip.classList.remove("visible")}function W(t){const e=a.activityTooltip.getBoundingClientRect();let n=t.clientY+20,o=t.clientX+10;o+e.width>window.innerWidth-8&&(o=t.clientX-e.width-10),n+e.height>window.innerHeight-8&&(n=t.clientY-e.height-10),a.activityTooltip.style.position="fixed",a.activityTooltip.style.top=`${n}px`,a.activityTooltip.style.left=`${o}px`}function Ot(t){if(!a.activityStats)return;const n=t.filter(l=>!l.isFuture).filter(l=>l.count>0).length,o=t.reduce((l,m)=>l+m.count,0),s=$t(t),r=g.getActiveProject();let c=`${o} tasks completed across ${n} days (${s} day streak)`;if(r&&r.isCompleted&&r.completedAt){const m=new Date(r.completedAt).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});c+=` â€¢ âœ… Completed ${m}`}a.activityStats.textContent=c}function $t(t){let e=0;const n=new Date;n.setHours(0,0,0,0);const o=j(n);let s=-1;for(let r=t.length-1;r>=0;r--)if(t[r].dateStr===o){s=r;break}if(s===-1){for(let r=t.length-1;r>=0;r--)if(!t[r].isFuture&&t[r].count>0)e++;else if(!t[r].isFuture)break;return e}for(let r=s;r>=0&&t[r].count>0;r--)e++;return e}function Ft(){console.log("Exporting data..."),console.log("Current state:",{projectCount:Object.keys(i.projects||{}).length,activeProjectId:i.activeProjectId,migrationVersion:i.migrationVersion});const t={version:"1.0",exportDate:new Date().toISOString(),data:{projects:i.projects,activeProjectId:i.activeProjectId,projectOrder:i.projectOrder,globalSettings:i.globalSettings,migrationVersion:i.migrationVersion}};console.log("Export data prepared:",{projectCount:Object.keys(t.data.projects||{}).length,dataSize:JSON.stringify(t).length});const e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=`launch-ext-backup-${j(new Date)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),console.log("Export completed")}async function _t(t){var e,n;try{const o=await t.text(),s=JSON.parse(o);if(console.log("Import data structure:",s),!s.version||!s.data)throw new Error("Invalid backup file format");if(s.data.projects){console.log("Importing multi-project data");const d=s.data.projects;Object.keys(d).forEach(u=>{const p=d[u];p.targetDate&&typeof p.targetDate=="string"&&(p.targetDate=new Date(p.targetDate)),p.goalCreatedAt&&typeof p.goalCreatedAt=="string"&&(p.goalCreatedAt=new Date(p.goalCreatedAt)),console.log(`Fixed dates for project ${u}:`,{goal:p.goal,targetDate:p.targetDate,goalCreatedAt:p.goalCreatedAt})}),i.projects=d,i.activeProjectId=s.data.activeProjectId,i.projectOrder=s.data.projectOrder||Object.keys(s.data.projects),i.globalSettings={...i.globalSettings,...s.data.globalSettings||{}}}else{console.log("Converting old single-project data to multi-project format"),console.log("Import data details:",{goal:s.data.goal,targetDate:s.data.targetDate,tasksCount:(e=s.data.tasks)==null?void 0:e.length,doneTasksCount:(n=s.data.doneTasks)==null?void 0:n.length});const d=g.generateProjectId(),u={id:d,goal:s.data.goal||"Imported Project",targetDate:s.data.targetDate?new Date(s.data.targetDate):null,goalCreatedAt:s.data.goalCreatedAt?new Date(s.data.goalCreatedAt):new Date,tasks:Array.isArray(s.data.tasks)?s.data.tasks:[],doneTasks:Array.isArray(s.data.doneTasks)?s.data.doneTasks:[],color:"#4CAF50",isActive:!0,order:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};console.log("Created new project:",u),i.projects={},i.projects[d]=u,i.activeProjectId=d,i.projectOrder=[d],console.log("Created new project from old format:",u)}i.migrationVersion=2,console.log("Final state after import:",{projectCount:Object.keys(i.projects).length,activeProjectId:i.activeProjectId,projects:Object.keys(i.projects).map(d=>({id:d,goal:i.projects[d].goal,tasksCount:i.projects[d].tasks.length,doneTasksCount:i.projects[d].doneTasks.length}))}),console.log("Saving imported state to storage..."),console.log("State before saving:",{projectCount:Object.keys(i.projects).length,activeProjectId:i.activeProjectId,migrationVersion:i.migrationVersion}),await y(),console.log("State saved successfully"),g.state=i,console.log("ProjectManager state updated"),v(),w();const r=document.getElementById("importInput");r&&(r.value="");const c=Object.keys(i.projects).length,l=g.getActiveProject(),m=l?`${l.tasks.length} todo tasks, ${l.doneTasks.length} completed tasks`:"No active project";f("Import Successful",`${c} project(s) imported successfully!
${m}`,"success")}catch(o){console.error("Import error:",o);const s=document.getElementById("importInput");s&&(s.value=""),f("Import Failed",`Error importing data: ${o.message}
Please check the console for details.`,"error")}}function Q(){const t=document.createElement("div");t.className="confetti-container",document.body.appendChild(t);const e=["#ff6b6b","#ff9500","#ffdd00","#4ecdc4","#45b7d1","#eb4d4b","#6c5ce7","#a29bfe"],n=["#ffff00","#ffffff","#ff8800","#ff4444"];for(let o=0;o<60;o++){const s=document.createElement("div");s.className="confetti";const r=Math.PI*2*o/60,c=200+Math.random()*300,l=e[Math.floor(Math.random()*e.length)];s.style.backgroundColor=l,s.style.setProperty("--burst-x",Math.cos(r)*c+"px"),s.style.setProperty("--burst-y",Math.sin(r)*c+"px"),s.style.animationDelay=Math.random()*.15+"s",s.style.animationDuration=2+Math.random()*1.5+"s",t.appendChild(s)}for(let o=0;o<40;o++){const s=document.createElement("div");s.className="confetti secondary";const r=Math.random()*Math.PI*2,c=150+Math.random()*200,l=e[Math.floor(Math.random()*e.length)];s.style.backgroundColor=l,s.style.setProperty("--burst-x",Math.cos(r)*c+"px"),s.style.setProperty("--burst-y",Math.sin(r)*c+"px"),s.style.animationDelay=.1+Math.random()*.2+"s",s.style.animationDuration=2.5+Math.random()*1+"s",t.appendChild(s)}for(let o=0;o<80;o++){const s=document.createElement("div");s.className="spark";const r=Math.random()*Math.PI*2,c=100+Math.random()*250,l=n[Math.floor(Math.random()*n.length)];s.style.backgroundColor=l,s.style.setProperty("--burst-x",Math.cos(r)*c+"px"),s.style.setProperty("--burst-y",Math.sin(r)*c+"px"),s.style.animationDelay=Math.random()*.3+"s",s.style.animationDuration=1.2+Math.random()*1+"s",t.appendChild(s)}setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},3e3)}async function Ht(){const t=g.getActiveProject();if(!t)return;const n=!t.isCompleted;try{await g.updateProject(t.id,{isCompleted:n,completedAt:n?new Date().toISOString():null}),n?(Jt(),f("Project completed! ðŸŽ‰","success")):f("Project resumed! ðŸš€","success"),v(),B()}catch(o){console.error("Error toggling project completion:",o),f("Error updating project status","error")}}function B(){const t=g.getActiveProject();!t||!a.toggleCompleteBtn||!a.statusIndicator||(t.isCompleted?(a.toggleCompleteBtn.textContent="Resume Project",a.toggleCompleteBtn.classList.add("completed"),a.toggleCompleteBtn.classList.remove("secondary"),a.statusIndicator.textContent="Completed",a.statusIndicator.classList.add("completed")):(a.toggleCompleteBtn.textContent="Mark Complete",a.toggleCompleteBtn.classList.remove("completed","secondary"),a.statusIndicator.textContent="In Progress",a.statusIndicator.classList.remove("completed")))}function Jt(){const t=document.createElement("div");t.className="confetti-container",document.body.appendChild(t);const e=["#ff6b6b","#ff9500","#ffdd00","#4ecdc4","#45b7d1","#eb4d4b","#6c5ce7","#a29bfe","#fd79a8","#fdcb6e"],n=["#ffff00","#ffffff","#ff8800","#ff4444","#00ff88","#8844ff"];[{x:"25%",y:"30%",delay:0},{x:"75%",y:"25%",delay:300},{x:"50%",y:"40%",delay:600},{x:"20%",y:"50%",delay:900},{x:"80%",y:"45%",delay:1200}].forEach((s,r)=>{setTimeout(()=>{Ut(t,s,e,n)},s.delay)}),setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},5e3)}function Ut(t,e,n,o){for(let s=0;s<40;s++){const r=document.createElement("div");r.className="confetti firework";const c=Math.PI*2*s/40,l=150+Math.random()*200,m=n[Math.floor(Math.random()*n.length)];r.style.backgroundColor=m,r.style.position="fixed",r.style.left=e.x,r.style.top=e.y,r.style.setProperty("--burst-x",Math.cos(c)*l+"px"),r.style.setProperty("--burst-y",Math.sin(c)*l+"px"),r.style.animationDelay=Math.random()*.1+"s",r.style.animationDuration=2.5+Math.random()*1+"s",t.appendChild(r)}for(let s=0;s<60;s++){const r=document.createElement("div");r.className="spark firework";const c=Math.random()*Math.PI*2,l=80+Math.random()*180,m=o[Math.floor(Math.random()*o.length)];r.style.backgroundColor=m,r.style.position="fixed",r.style.left=e.x,r.style.top=e.y,r.style.setProperty("--burst-x",Math.cos(c)*l+"px"),r.style.setProperty("--burst-y",Math.sin(c)*l+"px"),r.style.animationDelay=Math.random()*.2+"s",r.style.animationDuration=1.8+Math.random()*1.2+"s",t.appendChild(r)}}rt();

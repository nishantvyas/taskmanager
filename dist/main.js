(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function et(t,e){const n=t.getTime()-e.getTime();return Math.ceil(n/(1e3*60*60*24))}function ot(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60*60))}function nt(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/(1e3*60))}function at(t,e){const n=t.getTime()-e.getTime();return Math.floor(n/1e3)}let i={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]};class st{constructor(){this.state=i}generateProjectId(){return"project_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}async createProject(e){const n=this.generateProjectId(),o={id:n,goal:e.goal||"New Project",targetDate:e.targetDate||null,goalCreatedAt:e.goalCreatedAt||new Date,tasks:e.tasks||[],doneTasks:e.doneTasks||[],color:e.color||this.state.globalSettings.defaultProjectColor,isActive:!0,order:this.state.projectOrder.length,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.state.projects[n]=o,this.state.projectOrder.push(n),this.state.activeProjectId||(this.state.activeProjectId=n),await f(),o}getProject(e){return this.state.projects[e]||null}async updateProject(e,n){return this.state.projects[e]?(this.state.projects[e]={...this.state.projects[e],...n,updatedAt:new Date().toISOString()},await f(),this.state.projects[e]):null}async deleteProject(e){return this.state.projects[e]?(delete this.state.projects[e],this.state.projectOrder=this.state.projectOrder.filter(n=>n!==e),this.state.activeProjectId===e&&(this.state.activeProjectId=this.state.projectOrder.length>0?this.state.projectOrder[0]:null),await f(),!0):!1}getActiveProject(){return this.state.activeProjectId?this.state.projects[this.state.activeProjectId]:null}async setActiveProject(e){return this.state.projects[e]?(this.state.activeProjectId=e,await f(),!0):!1}getAllProjects(){return this.state.projectOrder.map(e=>this.state.projects[e]).filter(Boolean)}getActiveProjects(){return this.getAllProjects().filter(e=>e.isActive)}}const g=new st,a={countdown:document.getElementById("countdown"),days:document.getElementById("days"),hours:document.getElementById("hours"),minutes:document.getElementById("minutes"),seconds:document.getElementById("seconds"),goalTitle:document.getElementById("goalTitle"),addTaskBtn:document.getElementById("addTaskBtn"),todoList:document.getElementById("todoList"),doneList:document.getElementById("doneList"),settingsBtn:document.getElementById("settingsBtn"),settingsModal:document.getElementById("settingsModal"),taskModal:document.getElementById("taskModal"),taskInput:document.getElementById("taskInput"),taskDescription:document.getElementById("taskDescription"),saveTaskBtn:document.getElementById("saveTaskBtn"),deleteTaskBtn:document.getElementById("deleteTaskBtn"),closeTaskBtn:document.getElementById("closeTaskBtn"),goalInput:document.getElementById("goalInput"),dateInput:document.getElementById("dateInput"),saveSettingsBtn:document.getElementById("saveSettingsBtn"),closeSettingsBtn:document.getElementById("closeSettingsBtn"),listsContainer:document.querySelector(".lists-container"),prevList:document.getElementById("prevList"),nextList:document.getElementById("nextList"),activityMatrix:document.getElementById("activityMatrix"),activityStats:document.getElementById("activityStats"),activityTooltip:document.getElementById("activityTooltip"),projectDropdownBtn:document.getElementById("projectDropdownBtn"),projectDropdownMenu:document.getElementById("projectDropdownMenu"),currentProjectName:document.getElementById("currentProjectName"),addProjectBtn:document.getElementById("addProjectBtn"),projectList:document.getElementById("projectList"),projectDropdown:document.querySelector(".project-dropdown"),settingsTabs:document.querySelectorAll(".settings-tab"),settingsTabContents:document.querySelectorAll(".settings-tab-content"),projectColorInput:document.getElementById("projectColorInput"),deleteProjectBtn:document.getElementById("deleteProjectBtn"),allProjectsList:document.getElementById("allProjectsList"),createProjectModal:document.getElementById("createProjectModal"),newProjectName:document.getElementById("newProjectName"),newProjectDate:document.getElementById("newProjectDate"),newProjectColor:document.getElementById("newProjectColor"),createProjectBtn:document.getElementById("createProjectBtn"),cancelCreateProjectBtn:document.getElementById("cancelCreateProjectBtn"),confirmationModal:document.getElementById("confirmationModal"),confirmationTitle:document.getElementById("confirmationTitle"),confirmationMessage:document.getElementById("confirmationMessage"),confirmBtn:document.getElementById("confirmBtn"),cancelConfirmBtn:document.getElementById("cancelConfirmBtn"),notificationModal:document.getElementById("notificationModal"),notificationTitle:document.getElementById("notificationTitle"),notificationMessage:document.getElementById("notificationMessage"),closeNotificationBtn:document.getElementById("closeNotificationBtn"),projectNameCounter:document.getElementById("projectNameCounter"),goalCounter:document.getElementById("goalCounter")};let h=null,T=null;async function rt(){await lt(),ct(),v(),It(),ht()}function ct(){let t=!1;i.doneTasks.forEach(e=>{e.completedAt&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),i.tasks.forEach(e=>{(e.createdAt||e.updatedAt)&&!e.timestampMigrated&&(e.timestampMigrated=!0,t=!0)}),t&&(console.log("Marked tasks as migrated to new timezone handling"),f())}function it(){if(!i.projects)return;const t=new Date,e=new Date(t.getTime()-90*24*60*60*1e3);let n=0;Object.keys(i.projects).forEach(o=>{const s=i.projects[o];if(!Array.isArray(s.doneTasks)||s.doneTasks.length<=1e3)return;const c=[...s.doneTasks].sort((d,y)=>new Date(y.completedAt||y.updatedAt||y.createdAt)-new Date(d.completedAt||d.updatedAt||d.createdAt)).slice(0,1e3),m=new Set(c.map(d=>d.id)),l=s.doneTasks.filter(d=>m.has(d.id)?!1:new Date(d.completedAt||d.updatedAt||d.createdAt)>=e),u=[...c,...l];if(u.length<s.doneTasks.length){const d=s.doneTasks.length-u.length;n+=d,s.doneTasks=u}}),n>0&&(console.log(`Cleaned up ${n} old completed tasks across all projects`),f())}async function lt(){try{const t=await chrome.storage.local.get(["projects_data","global_settings","active_project","project_order","migration_version"]);t.migration_version===2&&t.projects_data?(console.log("Loading multi-project data"),i={projects:JSON.parse(t.projects_data),activeProjectId:t.active_project,projectOrder:JSON.parse(t.project_order||"[]"),globalSettings:JSON.parse(t.global_settings||"{}"),migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},i.globalSettings={theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10,...i.globalSettings}):(console.log("Checking for single-project data to migrate"),await dt()),it()}catch(t){console.error("Error loading state:",t),await H()}}async function dt(){console.log("Starting migration to multi-project structure");try{const t=await chrome.storage.local.get(["goalState","tasks","doneTasks"]);let e=!1,n={goal:"My First Project",targetDate:null,goalCreatedAt:new Date,tasks:[],doneTasks:[]};if(t.goalState){console.log("Found old single-project data, migrating...");const o=JSON.parse(t.goalState);n={goal:o.goal||"My First Project",targetDate:o.targetDate?new Date(o.targetDate):null,goalCreatedAt:o.goalCreatedAt?new Date(o.goalCreatedAt):new Date,tasks:t.tasks?JSON.parse(t.tasks):o.tasks||[],doneTasks:t.doneTasks?JSON.parse(t.doneTasks):o.doneTasks||[]},e=!0}else{const o=await chrome.storage.sync.get(["goalState","tasks","doneTasks"]);if(o.goalState){console.log("Found old sync storage data, migrating...");const s=JSON.parse(o.goalState);n={goal:s.goal||"My First Project",targetDate:s.targetDate?new Date(s.targetDate):null,goalCreatedAt:s.goalCreatedAt?new Date(s.goalCreatedAt):new Date,tasks:o.tasks?JSON.parse(o.tasks):s.tasks||[],doneTasks:o.doneTasks?JSON.parse(o.doneTasks):s.doneTasks||[]},e=!0}}i={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},e&&(console.log("Creating first project from migrated data"),await g.createProject(n)),await f(),await ut(),console.log("Migration completed successfully")}catch(t){console.error("Migration failed:",t),await H()}}async function H(){console.log("Initializing default multi-project state"),i={projects:{},activeProjectId:null,projectOrder:[],globalSettings:{theme:"dark",defaultProjectColor:"#4CAF50",showCompletedProjects:!1,maxProjects:10},migrationVersion:2,goal:"",targetDate:null,goalCreatedAt:null,tasks:[],doneTasks:[]},await f()}async function ut(){try{await chrome.storage.local.remove(["goalState","tasks","doneTasks"]),await chrome.storage.sync.remove(["goalState","tasks","doneTasks","goalSettings"]),console.log("Cleaned up old storage keys")}catch(t){console.log("Could not clean up old storage:",t)}}async function f(){try{await chrome.storage.local.set({projects_data:JSON.stringify(i.projects),global_settings:JSON.stringify(i.globalSettings),active_project:i.activeProjectId,project_order:JSON.stringify(i.projectOrder),migration_version:i.migrationVersion});try{const t={projectIds:Object.keys(i.projects),activeProjectId:i.activeProjectId,globalSettings:i.globalSettings,migrationVersion:i.migrationVersion};await chrome.storage.sync.set({projects_metadata:JSON.stringify(t)})}catch{console.log("Sync storage backup skipped (quota limit)")}}catch(t){throw console.error("Error saving to local storage:",t),t}}function v(){const t=g.getActiveProject();t&&t.goal&&t.targetDate?(a.goalTitle.textContent=`${t.goal}`,E()):(a.goalTitle.textContent="Click to set your goal...",V()),D(),I(),mt(),gt()}function gt(){const t=g.getActiveProject(),e=t?t.color:"#ffffff",n=document.querySelector(".goal-header h1");n&&(n.style.color=e),document.querySelectorAll(".countdown-number").forEach(r=>{r.style.color="#ffffff"}),document.querySelectorAll(".list-header h2").forEach(r=>{r.style.color="#ffffff"}),document.documentElement.style.setProperty("--project-color",e)}function mt(){const t=g.getActiveProject(),e=g.getActiveProjects();if(t?(a.currentProjectName.textContent=t.goal||"Untitled Project",document.title=`Launch Extension - ${t.goal}`):(a.currentProjectName.textContent="No Project Selected",document.title="Launch Extension"),a.projectList&&(a.projectList.innerHTML="",e.forEach(n=>{const o=document.createElement("div");o.className=`project-item ${n.id===i.activeProjectId?"active":""}`,o.dataset.projectId=n.id,o.innerHTML=`
                <div class="project-color" style="background-color: ${n.color}"></div>
                <div class="project-info">
                    <div class="project-name">${n.goal||"Untitled Project"}</div>
                    <div class="project-meta">
                        ${n.tasks.length} tasks â€¢ ${n.doneTasks.length} done
                    </div>
                </div>
            `,o.addEventListener("click",()=>_(n.id)),a.projectList.appendChild(o)}),e.length===0)){const n=document.createElement("div");n.className="project-empty-state",n.innerHTML=`
                <div style="padding: 1rem; text-align: center; color: rgba(255, 255, 255, 0.6);">
                    No projects yet. Click + to create one!
                </div>
            `,a.projectList.appendChild(n)}}async function _(t){await g.setActiveProject(t),v(),C()}function ft(){a.projectDropdown.classList.toggle("open")}function C(){a.projectDropdown.classList.remove("open")}function pt(){const t=new Date;t.setDate(t.getDate()+1),a.newProjectDate.value=t.toISOString().slice(0,16),a.newProjectName.value="",a.newProjectColor.value="#4CAF50",R(),L("createProjectModal"),setTimeout(()=>a.newProjectName.focus(),100)}async function M(){const t=a.newProjectName.value.trim(),e=a.newProjectDate.value,n=a.newProjectColor.value;if(!t){p("Error","Please enter a project name.");return}if(t.length>50){p("Error","Project name must be 50 characters or less.");return}if(!e){p("Error","Please select a target date.");return}try{const o=await g.createProject({goal:t,targetDate:new Date(e),goalCreatedAt:new Date,color:n});await g.setActiveProject(o.id),v(),C(),k("createProjectModal"),p("Success",`Project "${t}" created successfully!`)}catch(o){console.error("Error creating project:",o),p("Error","Failed to create project. Please try again.")}}function J(t){a.settingsTabs.forEach(o=>o.classList.remove("active")),a.settingsTabContents.forEach(o=>o.classList.remove("active"));const e=document.querySelector(`[data-tab="${t}"]`),n=document.getElementById(`${t}Tab`);e&&e.classList.add("active"),n&&n.classList.add("active")}function U(){if(!a.allProjectsList)return;const t=g.getAllProjects();a.allProjectsList.innerHTML="",t.forEach(e=>{const n=e.id===i.activeProjectId,o=document.createElement("div");o.className=`all-project-item ${n?"active":""}`;const s=e.doneTasks.length>0?Math.round(e.doneTasks.length/(e.tasks.length+e.doneTasks.length)*100):0;o.innerHTML=`
            <div class="all-project-color" style="background-color: ${e.color}"></div>
            <div class="all-project-info">
                <div class="all-project-name">${e.goal||"Untitled Project"}</div>
                <div class="all-project-details">
                    ${e.tasks.length} todo, ${e.doneTasks.length} done (${s}%)
                </div>
            </div>
            <div class="all-project-actions">
                <button class="project-action-btn" onclick="switchToProject('${e.id}')">
                    ${n?"Active":"Switch"}
                </button>
                <button class="project-action-btn" onclick="deleteProjectById('${e.id}')">
                    Delete
                </button>
            </div>
        `,a.allProjectsList.appendChild(o)}),t.length===0&&(a.allProjectsList.innerHTML=`
            <div style="text-align: center; padding: 2rem; color: rgba(255, 255, 255, 0.6);">
                No projects yet. Create your first project!
            </div>
        `)}function yt(){const t=g.getActiveProject();t&&q("Delete Project",`Are you sure you want to delete "${t.goal}"? This action cannot be undone and will delete all tasks.`,async()=>{try{await g.deleteProject(t.id),v(),P(),p("Success","Project deleted successfully.")}catch(e){console.error("Error deleting project:",e),p("Error","Failed to delete project. Please try again.")}})}function jt(t){const e=g.getProject(t);e&&q("Delete Project",`Are you sure you want to delete "${e.goal}"? This action cannot be undone and will delete all tasks.`,async()=>{try{await g.deleteProject(t),v(),U(),p("Success","Project deleted successfully.")}catch(n){console.error("Error deleting project:",n),p("Error","Failed to delete project. Please try again.")}})}async function vt(){const t=g.getActiveProject();if(!t||!a.projectColorInput)return;const e=a.projectColorInput.value;await g.updateProject(t.id,{color:e}),v()}function L(t){const e=document.getElementById(t);e&&e.classList.add("show")}function k(t){const e=document.getElementById(t);e&&e.classList.remove("show")}function p(t,e,n="info"){a.notificationTitle.textContent=t,a.notificationMessage.textContent=e;const o=a.notificationModal;o.className="modal",n==="error"?o.classList.add("error"):n==="success"&&o.classList.add("success"),L("notificationModal")}function q(t,e,n,o=null){a.confirmationTitle.textContent=t,a.confirmationMessage.textContent=e;const s=a.confirmBtn.cloneNode(!0),r=a.cancelConfirmBtn.cloneNode(!0);a.confirmBtn.parentNode.replaceChild(s,a.confirmBtn),a.cancelConfirmBtn.parentNode.replaceChild(r,a.cancelConfirmBtn),a.confirmBtn=s,a.cancelConfirmBtn=r,a.confirmBtn.addEventListener("click",()=>{k("confirmationModal"),n&&n()}),a.cancelConfirmBtn.addEventListener("click",()=>{k("confirmationModal"),o&&o()}),L("confirmationModal")}function R(){if(!a.newProjectName||!a.projectNameCounter)return;const t=a.newProjectName.value.length,e=50;a.projectNameCounter.textContent=t;const n=a.projectNameCounter.parentElement;t>=e?n.style.color="#f44336":t>=e*.8?n.style.color="#ff9800":n.style.color="rgba(255, 255, 255, 0.6)"}function X(){if(!a.goalInput||!a.goalCounter)return;const t=a.goalInput.value.length,e=50;a.goalCounter.textContent=t;const n=a.goalCounter.parentElement;t>=e?n.style.color="#f44336":t>=e*.8?n.style.color="#ff9800":n.style.color="rgba(255, 255, 255, 0.6)"}function V(){a.days.textContent="--",a.hours.textContent="--",a.minutes.textContent="--",a.seconds.textContent="--"}function E(){const t=g.getActiveProject();if(!t||!t.targetDate)return;const e=new Date,n=new Date(t.targetDate);if(e>=n){V();return}const o=et(n,e),s=ot(n,e)%24,r=nt(n,e)%60,c=at(n,e)%60;a.days.textContent=String(o).padStart(2,"0"),a.hours.textContent=String(s).padStart(2,"0"),a.minutes.textContent=String(r).padStart(2,"0"),a.seconds.textContent=String(c).padStart(2,"0")}function ht(){E(),setInterval(E,1e3)}function kt(t,e=""){return{title:t,description:e,createdAt:Date.now(),updatedAt:Date.now()}}function Y(t,e){return{...t,...e,updatedAt:Date.now()}}function b(t){return[...t].sort((e,n)=>n.updatedAt-e.updatedAt)}function x(t,e,n){const o=document.createElement("div");o.className="task-item",o.draggable=!0,o.dataset.index=e,o.dataset.list=n?"done":"todo";const s=document.createElement("h3");if(s.textContent=t.title,o.appendChild(s),t.description){const m=document.createElement("p");m.textContent=t.description,o.appendChild(m)}const r=document.createElement("div");r.className="task-time";const c=wt(t.updatedAt);return r.textContent=`Updated ${c}`,o.appendChild(r),o.addEventListener("dragstart",Dt),o.addEventListener("click",()=>z(t,e,n)),o}function wt(t){const e=new Date(t),n=new Date,o=e.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),s=e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==n.getFullYear()?"numeric":void 0}),r=j(n),c=j(e),m=new Date(n);m.setDate(m.getDate()-1);const l=j(m);return c===r?`Today at ${o}`:c===l?`Yesterday at ${o}`:`${s} at ${o}`}function D(){if(!a.todoList||!a.doneList)return;a.todoList.innerHTML="",a.doneList.innerHTML="";const t=g.getActiveProject();if(!t)return;const e=b(t.tasks),n=b(t.doneTasks);e.forEach(o=>{const s=t.tasks.findIndex(c=>c===o),r=x(o,s,!1);a.todoList.appendChild(r)}),n.forEach(o=>{const s=t.doneTasks.findIndex(c=>c===o),r=x(o,s,!0);a.doneList.appendChild(r)})}function z(t=null,e=null,n=!1){h=e,T=n?"done":"todo",t?(a.taskInput.value=t.title,a.taskDescription.value=t.description||""):(a.taskInput.value="",a.taskDescription.value=""),a.deleteTaskBtn&&(h!==null&&!n?a.deleteTaskBtn.style.display="inline-block":a.deleteTaskBtn.style.display="none"),a.taskModal.classList.add("show"),setTimeout(()=>a.taskInput.focus(),100)}function Pt(t){t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),G()):t.key==="Escape"&&(t.preventDefault(),w())}function G(){const t=a.taskInput.value.trim(),e=a.taskDescription.value.trim();if(!t)return;const n=g.getActiveProject();if(n){if(h!==null){const o=T==="done"?n.doneTasks:n.tasks,s=o[h];o[h]=Y(s,{title:t,description:e})}else n.tasks.push(kt(t,e));f(),D(),w()}}function Tt(){if(h===null)return;const t=g.getActiveProject();if(!t)return;const e=T==="done"?t.doneTasks:t.tasks;Array.isArray(e)&&e.splice(h,1),f(),v(),w()}function w(){a.taskModal.classList.remove("show"),h=null,T=null}function Dt(t){t.target.classList.add("dragging"),t.dataTransfer.setData("text/plain",JSON.stringify({index:t.target.dataset.index,list:t.target.dataset.list}))}function N(t){t.preventDefault();const e=t.target.closest(".task-list");e&&e.classList.add("drag-over")}function O(t){const e=t.target.closest(".task-list");e&&!e.contains(t.relatedTarget)&&e.classList.remove("drag-over")}function $(t){t.preventDefault();const e=t.target.closest(".task-list");if(!e)return;const n=g.getActiveProject();if(!n)return;e.classList.remove("drag-over");const o=JSON.parse(t.dataTransfer.getData("text/plain")),s=o.list==="todo"?n.tasks:n.doneTasks,r=e.id==="todoList"?n.tasks:n.doneTasks;if(s===r)return;const c=s[o.index];c&&(e.id==="doneList"?(c.completedAt=Date.now(),c.updatedAt=Date.now(),W()):e.id==="todoList"&&(delete c.completedAt,c.updatedAt=Date.now()),s.splice(o.index,1),r.push(c),f(),D(),I())}function F(){const t=g.getActiveProject();t&&(t.goal&&(a.goalInput.value=t.goal,X()),t.targetDate&&(a.dateInput.value=new Date(t.targetDate).toISOString().slice(0,16)),a.projectColorInput&&(a.projectColorInput.value=t.color||"#4CAF50")),U(),J("current"),a.settingsModal.classList.add("show")}function P(){a.settingsModal.classList.remove("show")}async function Et(){const t=a.goalInput.value.trim(),e=a.dateInput.value;if(t&&e){if(t.length>50){p("Error","Goal must be 50 characters or less.");return}let n=g.getActiveProject();if(!n)n=await g.createProject({goal:t,targetDate:new Date(e),goalCreatedAt:new Date});else{const o={goal:t,targetDate:new Date(e)};(!n.goal||n.goal!==t)&&(o.goalCreatedAt=new Date),await g.updateProject(n.id,o)}v(),P()}}function Ct(t,e,n){const o=parseInt(t.dataset.index),s=g.getActiveProject();if(!s)return;const r=e==="todo"?s.tasks:s.doneTasks,c=n==="todo"?s.tasks:s.doneTasks,m=r[o];if(m){const l=Y(m,{});n==="done"?(l.completedAt=Date.now(),W()):n==="todo"&&delete l.completedAt,r.splice(o,1),c.push(l),f(),D(),I()}}function Lt(){if(!window.matchMedia("(max-width: 768px)").matches)return;const t=document.createElement("div");t.className="task-move-feedback",document.body.appendChild(t);let e=0,n=0;const o=50,s=500;function r(l,u){e=l.touches[0].clientX,n=Date.now(),u.classList.add("being-moved")}function c(l,u){const d=l.changedTouches[0].clientX,Q=Date.now()-n,S=d-e;u.classList.remove("being-moved");const Z=Math.abs(S)<o&&Q<s,tt=Math.abs(S)>o;if(Z||tt){const B=u.closest(".task-list").id==="todoList"?"todo":"done",A=B==="todo"?"done":"todo";t.textContent=`Moving to ${A==="todo"?"To-Do":"Done"}`,t.classList.add("visible"),a.listsContainer.classList.toggle("show-done"),setTimeout(()=>{Ct(u,B,A),t.classList.remove("visible")},300)}}function m(l,u){const y=l.touches[0].clientX-e;Math.abs(y)>o&&l.preventDefault()}[a.todoList,a.doneList].forEach(l=>{l.addEventListener("touchstart",u=>{const d=u.target.closest(".task-item");d&&r(u,d)},{passive:!1}),l.addEventListener("touchend",u=>{const d=u.target.closest(".task-item");d&&c(u,d)}),l.addEventListener("touchmove",u=>{u.target.closest(".task-item")&&m(u)},{passive:!1})})}function It(){a.projectDropdownBtn.addEventListener("click",ft),a.addProjectBtn.addEventListener("click",pt),a.settingsTabs.forEach(o=>{o.addEventListener("click",()=>J(o.dataset.tab))}),a.deleteProjectBtn&&a.deleteProjectBtn.addEventListener("click",yt),a.projectColorInput&&a.projectColorInput.addEventListener("change",vt),a.createProjectBtn&&a.createProjectBtn.addEventListener("click",M),a.cancelCreateProjectBtn&&a.cancelCreateProjectBtn.addEventListener("click",()=>k("createProjectModal")),a.closeNotificationBtn&&a.closeNotificationBtn.addEventListener("click",()=>k("notificationModal")),a.newProjectColor&&a.newProjectColor.addEventListener("change",o=>{const s=a.createProjectModal.querySelector(".color-preview");s&&(s.style.backgroundColor=o.target.value)}),a.newProjectName&&(a.newProjectName.addEventListener("keydown",o=>{o.key==="Enter"?(o.preventDefault(),M()):o.key==="Escape"&&(o.preventDefault(),k("createProjectModal"))}),a.newProjectName.addEventListener("input",R)),a.goalInput&&a.goalInput.addEventListener("input",X),document.addEventListener("click",o=>{a.projectDropdown.contains(o.target)||C()}),a.addTaskBtn.addEventListener("click",()=>z()),a.saveTaskBtn.addEventListener("click",G),a.deleteTaskBtn.addEventListener("click",Tt),a.closeTaskBtn.addEventListener("click",w),a.settingsBtn.addEventListener("click",F),a.closeSettingsBtn.addEventListener("click",P),a.saveSettingsBtn.addEventListener("click",Et),a.nextList.addEventListener("click",()=>{a.listsContainer.classList.add("show-done")}),a.prevList.addEventListener("click",()=>{a.listsContainer.classList.remove("show-done")}),a.taskInput.addEventListener("keydown",Pt),a.taskDescription.addEventListener("keydown",o=>{o.key==="Escape"&&(o.preventDefault(),w())}),Lt(),window.matchMedia("(max-width: 768px)").matches||(a.todoList.addEventListener("dragover",N),a.todoList.addEventListener("dragleave",O),a.todoList.addEventListener("drop",$),a.doneList.addEventListener("dragover",N),a.doneList.addEventListener("dragleave",O),a.doneList.addEventListener("drop",$)),a.goalTitle.addEventListener("click",F),window.addEventListener("click",o=>{o.target===a.taskModal&&w(),o.target===a.settingsModal&&P()});const t=document.getElementById("exportBtn");t&&t.addEventListener("click",Ft);const e=document.getElementById("importBtn"),n=document.getElementById("importInput");e&&n&&(e.addEventListener("click",()=>n.click()),n.addEventListener("change",o=>{o.target.files.length>0&&Ht(o.target.files[0])}))}function I(){const t=g.getActiveProject();if(!a.activityMatrix||!t||!t.goalCreatedAt)return;const e=St(t);bt(e),Ot(e)}function St(t){const e=Bt(t),n=[];if(!t||!t.goalCreatedAt||!t.targetDate)return n;const o=new Date;o.setHours(23,59,59,999);const s=new Date(t.targetDate);s.setHours(23,59,59,999);const r=s>o?s:o,c=new Date(e);for(;c<=r;){const m=j(c),l=At(m,t),u=j(new Date)===m,d=c>new Date;n.push({date:new Date(c),dateStr:m,count:l,level:d&&!u?-1:Mt(l),dayOfWeek:c.getDay(),isToday:u,isFuture:d&&!u}),c.setDate(c.getDate()+1)}return n}function Bt(t){let e=t.goalCreatedAt?new Date(t.goalCreatedAt):new Date;const n=[...t.tasks,...t.doneTasks];if(n.length>0){const o=Math.min(...n.map(r=>r.createdAt||Date.now())),s=new Date(o);s<e&&(e=s)}return e.setHours(0,0,0,0),e}function j(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${e}-${n}-${o}`}function At(t,e){return e.doneTasks.filter(n=>{if(!n.completedAt)return!1;const o=new Date(n.completedAt);return j(o)===t}).length}function Mt(t){return t===0?0:t<=2?1:t<=4?2:t<=6?3:4}function bt(t){a.activityMatrix.innerHTML="",t.forEach(e=>{const n=document.createElement("div");let o="matrix-day";e.level===-1?o+=" matrix-day-future":o+=` matrix-day-${e.level}`,e.isToday&&(o+=" matrix-day-today"),n.className=o,n.dataset.date=e.dateStr,n.dataset.count=e.count,n.addEventListener("mouseenter",xt),n.addEventListener("mouseleave",Nt),n.addEventListener("mousemove",K),a.activityMatrix.appendChild(n)})}function xt(t){const e=t.target,n=e.dataset.date,o=parseInt(e.dataset.count),r=j(new Date),c=n===r,m=new Date(n+"T00:00:00"),l=n>r,u=m.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});let d;l&&!c?d=`No activity yet on ${u}`:c?d=`${o} ${o===1?"task":"tasks"} completed today`:d=`${o} ${o===1?"task":"tasks"} completed on ${u}`,a.activityTooltip.textContent=d,a.activityTooltip.classList.add("visible"),K(t)}function Nt(){a.activityTooltip.classList.remove("visible")}function K(t){const e=a.activityTooltip.getBoundingClientRect();let n=t.clientY+20,o=t.clientX+10;o+e.width>window.innerWidth-8&&(o=t.clientX-e.width-10),n+e.height>window.innerHeight-8&&(n=t.clientY-e.height-10),a.activityTooltip.style.position="fixed",a.activityTooltip.style.top=`${n}px`,a.activityTooltip.style.left=`${o}px`}function Ot(t){if(!a.activityStats)return;const n=t.filter(r=>!r.isFuture).filter(r=>r.count>0).length,o=t.reduce((r,c)=>r+c.count,0),s=$t(t);a.activityStats.textContent=`${o} tasks completed across ${n} days (${s} day streak)`}function $t(t){let e=0;const n=new Date;n.setHours(0,0,0,0);const o=j(n);let s=-1;for(let r=t.length-1;r>=0;r--)if(t[r].dateStr===o){s=r;break}if(s===-1){for(let r=t.length-1;r>=0;r--)if(!t[r].isFuture&&t[r].count>0)e++;else if(!t[r].isFuture)break;return e}for(let r=s;r>=0&&t[r].count>0;r--)e++;return e}function Ft(){const t={version:"1.0",exportDate:new Date().toISOString(),data:{goal:i.goal,targetDate:i.targetDate?i.targetDate.toISOString():null,goalCreatedAt:i.goalCreatedAt?i.goalCreatedAt.toISOString():null,tasks:i.tasks,doneTasks:i.doneTasks}},e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=`launch-ext-backup-${j(new Date)}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}async function Ht(t){var e,n;try{const o=await t.text(),s=JSON.parse(o);if(console.log("Import data structure:",s),!s.version||!s.data)throw new Error("Invalid backup file format");if(s.data.projects)console.log("Importing multi-project data"),i.projects=s.data.projects,i.activeProjectId=s.data.activeProjectId,i.projectOrder=s.data.projectOrder||Object.keys(s.data.projects),i.globalSettings={...i.globalSettings,...s.data.globalSettings||{}};else{console.log("Converting old single-project data to multi-project format"),console.log("Import data details:",{goal:s.data.goal,targetDate:s.data.targetDate,tasksCount:(e=s.data.tasks)==null?void 0:e.length,doneTasksCount:(n=s.data.doneTasks)==null?void 0:n.length});const l=g.generateProjectId(),u={id:l,goal:s.data.goal||"Imported Project",targetDate:s.data.targetDate?new Date(s.data.targetDate):null,goalCreatedAt:s.data.goalCreatedAt?new Date(s.data.goalCreatedAt):new Date,tasks:Array.isArray(s.data.tasks)?s.data.tasks:[],doneTasks:Array.isArray(s.data.doneTasks)?s.data.doneTasks:[],color:"#4CAF50",isActive:!0,order:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};console.log("Created new project:",u),i.projects={},i.projects[l]=u,i.activeProjectId=l,i.projectOrder=[l]}i.migrationVersion=2,console.log("Final state after import:",{projectCount:Object.keys(i.projects).length,activeProjectId:i.activeProjectId,projects:Object.keys(i.projects).map(l=>({id:l,goal:i.projects[l].goal,tasksCount:i.projects[l].tasks.length,doneTasksCount:i.projects[l].doneTasks.length}))}),await f(),g.state=i,v(),P();const r=Object.keys(i.projects).length,c=g.getActiveProject(),m=c?`${c.tasks.length} todo tasks, ${c.doneTasks.length} completed tasks`:"No active project";p("Import Successful",`${r} project(s) imported successfully!
${m}`,"success")}catch(o){console.error("Import error:",o),p("Import Failed",`Error importing data: ${o.message}
Please check the console for details.`,"error")}}function W(){const t=document.createElement("div");t.className="confetti-container",document.body.appendChild(t);const e=["#ff6b6b","#ff9500","#ffdd00","#4ecdc4","#45b7d1","#eb4d4b","#6c5ce7","#a29bfe"],n=["#ffff00","#ffffff","#ff8800","#ff4444"];for(let o=0;o<60;o++){const s=document.createElement("div");s.className="confetti";const r=Math.PI*2*o/60,c=200+Math.random()*300,m=e[Math.floor(Math.random()*e.length)];s.style.backgroundColor=m,s.style.setProperty("--burst-x",Math.cos(r)*c+"px"),s.style.setProperty("--burst-y",Math.sin(r)*c+"px"),s.style.animationDelay=Math.random()*.15+"s",s.style.animationDuration=2+Math.random()*1.5+"s",t.appendChild(s)}for(let o=0;o<40;o++){const s=document.createElement("div");s.className="confetti secondary";const r=Math.random()*Math.PI*2,c=150+Math.random()*200,m=e[Math.floor(Math.random()*e.length)];s.style.backgroundColor=m,s.style.setProperty("--burst-x",Math.cos(r)*c+"px"),s.style.setProperty("--burst-y",Math.sin(r)*c+"px"),s.style.animationDelay=.1+Math.random()*.2+"s",s.style.animationDuration=2.5+Math.random()*1+"s",t.appendChild(s)}for(let o=0;o<80;o++){const s=document.createElement("div");s.className="spark";const r=Math.random()*Math.PI*2,c=100+Math.random()*250,m=n[Math.floor(Math.random()*n.length)];s.style.backgroundColor=m,s.style.setProperty("--burst-x",Math.cos(r)*c+"px"),s.style.setProperty("--burst-y",Math.sin(r)*c+"px"),s.style.animationDelay=Math.random()*.3+"s",s.style.animationDuration=1.2+Math.random()*1+"s",t.appendChild(s)}setTimeout(()=>{document.body.contains(t)&&document.body.removeChild(t)},3e3)}window.switchToProject=_;window.deleteProjectById=jt;rt();
